

<!DOCTYPE html>
<html lang="zh-Hans" color-mode=light>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>python设计模式 - So1n blog</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  
  <meta name="description" content="前记设计模式都是前人根据代码经验汇总而来的, 我们需要...">
  <meta name="author" content="So1n">
  <link rel="icon" href="/images/icons/favicon.ico" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon.ico" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/favicon.ico" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon.ico">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_s6x2xcokxrl.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/atom-one-dark-reasonable.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/atom-one-dark-reasonable.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: true,
        only_post: 'true',
        loading: '/images/theme/puff.svg'
      },
      donate: {
        enable: true,
        alipay: 'https://github.com/so1n/so1n_blog_photo/blob/master/blog_photo/4d2ebf32586d8799ee2e75333d6f5d2.jpg?raw=true',
        wechat: ''
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        always_show: true
      },
      carrier: {
        enable: false
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: 'I`m   So1n',
          typing: true,
          api: '',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: true,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'simple'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: true,
        path: 'search.xml'
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="lock-screen">
  <div class="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
        <i class="iconfont iconqrcode j-navbar-qrcode"></i>
      
      
        <i class="iconfont iconmoono" id="color-toggle" color-toggle="light"></i>
      
      
        <i class="iconfont iconsearch j-navbar-search"></i>
      
    </div>
    <div class="center">python设计模式</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
      <div id="qrcode-navbar"></div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a target="_blank" rel="noopener" href="http://so1nz.lofter.com/ " class="underline "> 时光</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/tags/ " class="underline "> 标签</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> 分类</a>
      </li><li class="menu-item">
        <a href="/project/ " class="underline "> 项目</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img src="/images/theme/post-image.jpg" draggable="false">
  <div class="head-mask">
    <h1 class="head-title">python设计模式</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>November 10, 2017</span>
      
      本文总阅读量<span id="busuanzi_value_page_pv"></span>次
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>61432</span>
    </div>
  </div>
</section>

    <section class="main">
      <section class="content">
        <!-- 展示文章摘录 -->
        <h2 id="前记"><a href="#前记" class="headerlink" title="前记"></a>前记</h2><p>设计模式都是前人根据代码经验汇总而来的, 我们需要学习如何使用设计模式, 但是切忌被设计模式囚禁住我们的思想<br>设计模式虽然都是在描述编程的，但是很多也是来源于生活的实例，就拿一台单反来举例:</p>
<ul>
<li>工厂模式  单反的外观由很多塑料来制作的，其中塑料属于原料，但通过不同的模具生产出不一样的模块。</li>
<li>造者模式  组成一台单反有很多原件，需要机器或工人按照规划好的程序，把部件组装起来，只有部件组装完成，单反才可以使用。</li>
<li>抽象工厂模式  单反里面有m档,a档p档s档等，选择不同的档，就有不一样的功能</li>
<li>单例模式  单反中有个反光镜，拍摄前，反光镜把景像反射到取景器，拍摄时，反光镜把景物反射给cmos，然后进行拍摄，其中景象的呈现只能2选1，不能两个都选取</li>
<li>原型模式  现在单反一开始有个raw格式，这是刚出来的格式，但是jpg格式是通过一定的程序修图后呈现出来的图片，这时，raw格式的图片不会被影响。</li>
<li>适配器模式  单反通过更改不同的镜头，可以用来拍摄微距，或者拍星空和人像等等</li>
<li>修饰器模式  通过在单反镜头前面加个不同uv镜片，可以让拍出来的照片可以减光，或者灯光有星芒。</li>
<li>外观模式  自动挡在点击拍摄时，单反自己进行对焦，决定用什么快门，光圈等等，用户不知道这些是如何执行，只知道按了拍摄按钮</li>
<li>状态模式  单反的闪光灯，在选择自动，打开，或关闭时。闪关灯在拍照时有不同的执行的操作，切闪光灯的这三个选项还可以进行切换。
        <h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2>如果后面带有星号就是认为比较重要的模式，虽然这个是阅读完《python编程实战》的设计模式部分，《精通python设计模式》，以及c语言和java语言版本的《设计模式》后才写出来的，但电脑里有《精通python设计模式》的电子书和代码，所以很多都引用了这本书（之所以会读这样多相同的书，是因为在备考ccna时很闷，有时就翻一翻其他书看一看）</li>
</ul>
<p>2020-12-19代码进行了重构</p>
<h2 id="创建型模式"><a href="#创建型模式" class="headerlink" title="创建型模式"></a>创建型模式</h2><h3 id="工厂模式-（-）"><a href="#工厂模式-（-）" class="headerlink" title="工厂模式 （*）"></a>工厂模式 （*）</h3><blockquote>
<p>在工厂设计模式中，客户端可以请求一个对象，而无需知道这个对象来自哪里；也就是，使用哪个类来生成这个对象。工厂背后的思想是简化对象的创建。与客户端自己基于类实例化直接创建对象相比，基于一个中心化函数来实现，更易于追踪创建了哪些对象。通过将创建对象的代码和使用对象的代码解耦，工厂能够降低应用维护的复杂度</p>
</blockquote>
<blockquote>
<p>工厂通常有两种形式：一种是工厂方法（Factory Method），它是一个方法（或以地道的Python术语来说，是一个函数），对不同的输入参数返回不同的对象,第二种是抽象工厂，它是一组用于创建一系列相关事物对象的工厂方法</p>
</blockquote>
<p>现实中用到工厂方法模式思想的一个例子是塑料玩具制造。制造塑料玩具的压塑粉都是一样的，但使用不同的塑料模具就能产出不同的外形。比如，有一个工厂方法，输入是目标外形（鸭子或小车）的名称，输出则是要求的塑料外形</p>
<p>工厂模式使用场景</p>
<blockquote>
<p>如果因为应用创建对象的代码分布在多个不同的地方，而不是仅在一个函数/方法中，你发现没法跟踪这些对象，那么应该考虑使用工厂方法模式。工厂方法集中地在一个地方创建对象，使对象跟踪变得更容易。注意，创建多个工厂方法也完全没有问题，实践中通常也这么做，对相似的对象创建进行逻辑分组，每个工厂方法负责一个分组。例如，有一个工厂方法负责连接到不同的数据库（MySQL、 SQLite），另一个工厂方法负责创建要求的几何对象（圆形、三角形），等等。<br>若需要将对象的创建和使用解耦，工厂方法也能派上用场。创建对象时，我们并没有与某个特定类耦合/绑定到一起，而只是通过调用某个函数来提供关于我们想要什么的部分信息。这意味着修改这个函数比较容易，不需要同时修改使用这个函数的代码。<br>另外一个值得一提的应用案例与应用性能及内存使用相关。工厂方法可以在必要时创建新的对象，从而提高性能和内存使用率。若直接实例化类来创建对象，那么每次创建新对象就需要分配额外的内存（除非这个类内部使用了缓存，一般情况下不会这样）。</p>
</blockquote>
<p>代码示例（来自于《精通python设计模式》）：<br>最主要的是connection_factory函数里，根据不同的文件，选择不同的方法加工，再传回去</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> etree<br><span class="hljs-keyword">import</span> json<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JSONConnector</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, filepath</span>):</span><br>        self.data = <span class="hljs-built_in">dict</span>()<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filepath, mode=<span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            self.data = json.load(f)<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parsed_data</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.data<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">XMLConnector</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, filepath</span>):</span><br>        self.tree = etree.parse(filepath)<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parsed_data</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.tree<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connection_factory</span>(<span class="hljs-params">filepath</span>):</span><br>    <span class="hljs-keyword">if</span> filepath.endswith(<span class="hljs-string">&#x27;json&#x27;</span>):<br>        connector = JSONConnector<br>    <span class="hljs-keyword">elif</span> filepath.endswith(<span class="hljs-string">&#x27;xml&#x27;</span>):<br>        connector = XMLConnector<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Cannot connect to &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(filepath))<br>    <span class="hljs-keyword">return</span> connector(filepath)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connect_to</span>(<span class="hljs-params">filepath</span>):</span><br>    factory = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">try</span>:<br>        factory = connection_factory(filepath)<br>    <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> ve:<br>        print(ve)<br>    <span class="hljs-keyword">return</span> factory<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    sqlite_factory = connect_to(<span class="hljs-string">&#x27;data/person.sq3&#x27;</span>)<br>    print()<br><br>    xml_factory = connect_to(<span class="hljs-string">&#x27;data/person.xml&#x27;</span>)<br>    xml_data = xml_factory.parsed_data<br>    liars = xml_data.findall(<span class="hljs-string">&quot;.//&#123;&#125;[&#123;&#125;=&#x27;&#123;&#125;&#x27;]&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;person&#x27;</span>,<br>                                                     <span class="hljs-string">&#x27;lastName&#x27;</span>, <span class="hljs-string">&#x27;Liar&#x27;</span>))<br>    print(<span class="hljs-string">&#x27;found: &#123;&#125; persons&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(liars)))<br>    <span class="hljs-keyword">for</span> liar <span class="hljs-keyword">in</span> liars:<br>        print(<span class="hljs-string">&#x27;first name: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(liar.find(<span class="hljs-string">&#x27;firstName&#x27;</span>).text))<br>        print(<span class="hljs-string">&#x27;last name: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(liar.find(<span class="hljs-string">&#x27;lastName&#x27;</span>).text))<br>        [print(<span class="hljs-string">&#x27;phone number (&#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(p.attrib[<span class="hljs-string">&#x27;type&#x27;</span>]),<br>               p.text) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> liar.find(<span class="hljs-string">&#x27;phoneNumbers&#x27;</span>)]<br><br>    print()<br><br>    json_factory = connect_to(<span class="hljs-string">&#x27;data/donut.json&#x27;</span>)<br>    json_data = json_factory.parsed_data<br>    print(<span class="hljs-string">&#x27;found: &#123;&#125; donuts&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(json_data)))<br>    <span class="hljs-keyword">for</span> donut <span class="hljs-keyword">in</span> json_data:<br>        print(<span class="hljs-string">&#x27;name: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(donut[<span class="hljs-string">&#x27;name&#x27;</span>]))<br>        print(<span class="hljs-string">&#x27;price: $&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(donut[<span class="hljs-string">&#x27;ppu&#x27;</span>]))<br>        [print(<span class="hljs-string">&#x27;topping: &#123;&#125; &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(t[<span class="hljs-string">&#x27;id&#x27;</span>], t[<span class="hljs-string">&#x27;type&#x27;</span>])) <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> donut[<span class="hljs-string">&#x27;topping&#x27;</span>]]<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure>
<h3 id="建造者模式（-）"><a href="#建造者模式（-）" class="headerlink" title="建造者模式（*）"></a>建造者模式（*）</h3><blockquote>
<p>假设我们想要创建一个HTML页面生成器， HTML页面的基本结构（构造组件）通常是一样的：以&lt;html&gt;开始&lt;/html&gt;结束，在HTML部分中有&lt;head&gt;和&lt;/head&gt;元素，在head部分中又有&lt;title&gt;和&lt;/title&gt;元素，等等；但页面在表现上可以不同。每个页面有自己的页面标题、文本标题以及不同的&lt;body/&gt;内容。此外，页面通常是经过多个步骤创建完成的：有一个函数添加页面标题，另一个添加主文本标题，还有一个添加页脚，等等。仅当一个页面的结构全部完成后，才能使用一个最终的渲染函数将该页面展示在客户端。我们甚至可以更进一步扩展这个HTML生成器，让它可以生成一些完全不同的HTML页面。一个页面可能包含表格，另一个页面可能包含图像库，还有一个页面包含联系表单，等等。<br>HTML页面生成问题可以使用建造者模式来解决。该模式中，有两个参与者：建造者 （builder）和指挥者（director）。建造者负责创建复杂对象的各个组成部分。在HTML例子中，这些组成部分是页面标题、文本标题、内容主体及页脚。指挥者使用一个建造者实例控制建造的过程。对于HTML示例，这是指调用建造者的函数设置页面标题、文本标题等。使用不同的建造者实例让我们可以创建不同的HTML页面，而无需变更指挥者的代码</p>
</blockquote>
<p>说白了就是在金拱门点了餐后，工作人员按着订单拿着汉堡，薯条，可乐等到餐盘上，东西都弄好后，就可以递给我了（其中，其他人工作人员就有专门做薯条的，做汉堡的）<br>其中的我就相当于建造者模式的客户端，按着订单取货的工作人员是指挥员，其他工作人员是建造者</p>
<p>如果我们知道一个对象必须经过多个步骤来创建，并且要求同一个构造过程可以产生不同的表现，就可以使用建造者模式。这种需求存在于许多应用中，例如页面生成器、文档转换器以及用户界面（User Interface，UI）表单创建工具</p>
<p>工厂模式和建造者模式有两个区别：</p>
<ul>
<li>主要的区别在于工厂模式以单个步骤创建对象，而建造者模式以多个步骤创建对象，并且几乎始终会使用一个指挥者。一些有针对性的建造者模式实现并未使用指挥者，如Java的StringBuilder，但这只是例外。</li>
<li>另一个区别是，在工厂模式下，会立即返回一个创建好的对象；而在建造者模式下，仅在需要时客户端代码才显式地请求指挥者返回最终的对象<br>就像直接买配置好的笔记本电脑和组装的台式机一样</li>
</ul>
<p>示例代码如下（来自于《精通python设计模式》）:<br>改例中，使用工厂模式，有两个pizza类可以选取，然后通过指挥者(Waiter)来一步一步创建，这里并没返回数据，当创建完时，才一起返回数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum<br><span class="hljs-keyword">import</span> time<br><br>PizzaProgress = Enum(<span class="hljs-string">&#x27;PizzaProgress&#x27;</span>, <span class="hljs-string">&#x27;queued preparation baking ready&#x27;</span>)<br>PizzaDough = Enum(<span class="hljs-string">&#x27;PizzaDough&#x27;</span>, <span class="hljs-string">&#x27;thin thick&#x27;</span>)<br>PizzaSauce = Enum(<span class="hljs-string">&#x27;PizzaSauce&#x27;</span>, <span class="hljs-string">&#x27;tomato creme_fraiche&#x27;</span>)<br>PizzaTopping = Enum(<span class="hljs-string">&#x27;PizzaTopping&#x27;</span>, <span class="hljs-string">&#x27;mozzarella double_mozzarella bacon ham mushrooms red_onion oregano&#x27;</span>)<br>STEP_DELAY = <span class="hljs-number">3</span>          <span class="hljs-comment"># 考虑是示例，单位为秒</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pizza</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span><br>        self.name = name<br>        self.dough = <span class="hljs-literal">None</span><br>        self.sauce = <span class="hljs-literal">None</span><br>        self.topping = []<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">prepare_dough</span>(<span class="hljs-params">self, dough</span>):</span><br>        self.dough = dough<br>        print(<span class="hljs-string">&#x27;preparing the &#123;&#125; dough of your &#123;&#125;...&#x27;</span>.<span class="hljs-built_in">format</span>(self.dough.name, self))<br>        time.sleep(STEP_DELAY)<br>        print(<span class="hljs-string">&#x27;done with the &#123;&#125; dough&#x27;</span>.<span class="hljs-built_in">format</span>(self.dough.name))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MargaritaBuilder</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.pizza = Pizza(<span class="hljs-string">&#x27;margarita&#x27;</span>)<br>        self.progress = PizzaProgress.queued<br>        self.baking_time = <span class="hljs-number">5</span>        <span class="hljs-comment"># 考虑是示例，单位为秒</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">prepare_dough</span>(<span class="hljs-params">self</span>):</span><br>        self.progress = PizzaProgress.preparation<br>        self.pizza.prepare_dough(PizzaDough.thin)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_sauce</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;adding the tomato sauce to your margarita...&#x27;</span>)<br>        self.pizza.sauce = PizzaSauce.tomato<br>        time.sleep(STEP_DELAY)<br>        print(<span class="hljs-string">&#x27;done with the tomato sauce&#x27;</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_topping</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;adding the topping (double mozzarella, oregano) to your margarita&#x27;</span>)<br>        self.pizza.topping.append([i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span><br>                                   (PizzaTopping.double_mozzarella, PizzaTopping.oregano)])<br>        time.sleep(STEP_DELAY)<br>        print(<span class="hljs-string">&#x27;done with the topping (double mozzarrella, oregano)&#x27;</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bake</span>(<span class="hljs-params">self</span>):</span><br>        self.progress = PizzaProgress.baking<br>        print(<span class="hljs-string">&#x27;baking your margarita for &#123;&#125; seconds&#x27;</span>.<span class="hljs-built_in">format</span>(self.baking_time))<br>        time.sleep(self.baking_time)<br>        self.progress = PizzaProgress.ready<br>        print(<span class="hljs-string">&#x27;your margarita is ready&#x27;</span>)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreamyBaconBuilder</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.pizza = Pizza(<span class="hljs-string">&#x27;creamy bacon&#x27;</span>)<br>        self.progress = PizzaProgress.queued<br>        self.baking_time = <span class="hljs-number">7</span>        <span class="hljs-comment"># 考虑是示例，单位为秒</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">prepare_dough</span>(<span class="hljs-params">self</span>):</span><br>        self.progress = PizzaProgress.preparation<br>        self.pizza.prepare_dough(PizzaDough.thick)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_sauce</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;adding the crème fraîche sauce to your creamy bacon&#x27;</span>)<br>        self.pizza.sauce = PizzaSauce.creme_fraiche<br>        time.sleep(STEP_DELAY)<br>        print(<span class="hljs-string">&#x27;done with the crème fraîche sauce&#x27;</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_topping</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;adding the topping (mozzarella, bacon, ham, mushrooms, red onion, oregano) to your creamy bacon&#x27;</span>)<br>        self.pizza.topping.append([t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span><br>                                   (PizzaTopping.mozzarella, PizzaTopping.bacon,<br>                                    PizzaTopping.ham, PizzaTopping.mushrooms,<br>                                    PizzaTopping.red_onion, PizzaTopping.oregano)])<br>        time.sleep(STEP_DELAY)<br>        print(<span class="hljs-string">&#x27;done with the topping (mozzarella, bacon, ham, mushrooms, red onion, oregano)&#x27;</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bake</span>(<span class="hljs-params">self</span>):</span><br>        self.progress = PizzaProgress.baking<br>        print(<span class="hljs-string">&#x27;baking your creamy bacon for &#123;&#125; seconds&#x27;</span>.<span class="hljs-built_in">format</span>(self.baking_time))<br>        time.sleep(self.baking_time)<br>        self.progress = PizzaProgress.ready<br>        print(<span class="hljs-string">&#x27;your creamy bacon is ready&#x27;</span>)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Waiter</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.builder = <span class="hljs-literal">None</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">construct_pizza</span>(<span class="hljs-params">self, builder</span>):</span><br>        self.builder = builder<br>        [step() <span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> (builder.prepare_dough,<br>                             builder.add_sauce, builder.add_topping, builder.bake)]<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pizza</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.builder.pizza<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate_style</span>(<span class="hljs-params">builders</span>):</span><br>    <span class="hljs-keyword">try</span>:<br>        pizza_style = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;What pizza would you like, [m]argarita or [c]reamy bacon? &#x27;</span>)<br>        builder = builders[pizza_style]()<br>        valid_input = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">except</span> KeyError <span class="hljs-keyword">as</span> err:<br>        print(<span class="hljs-string">&#x27;Sorry, only margarita (key m) and creamy bacon (key c) are available&#x27;</span>)<br>        <span class="hljs-keyword">return</span> (<span class="hljs-literal">False</span>, <span class="hljs-literal">None</span>)<br>    <span class="hljs-keyword">return</span> (<span class="hljs-literal">True</span>, builder)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    builders = <span class="hljs-built_in">dict</span>(m=MargaritaBuilder, c=CreamyBaconBuilder)<br>    valid_input = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> valid_input:<br>        valid_input, builder = validate_style(builders)<br>    print()<br>    waiter = Waiter()<br>    waiter.construct_pizza(builder)<br>    pizza = waiter.pizza<br>    print()<br>    print(<span class="hljs-string">&#x27;Enjoy your &#123;&#125;!&#x27;</span>.<span class="hljs-built_in">format</span>(pizza))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<h3 id="抽象工厂模式（-）"><a href="#抽象工厂模式（-）" class="headerlink" title="抽象工厂模式（*）"></a>抽象工厂模式（*）</h3><blockquote>
<p>抽象工厂设计模式是抽象方法的一种泛化。概括来说，一个抽象工厂是（逻辑上的）一组工<br>厂方法，其中的每个工厂方法负责产生不同种类的对象</p>
</blockquote>
<blockquote>
<p>汽车制造业应用了抽象工厂的思想。冲压不同汽车模型的部件（车门、仪表盘、车篷、挡泥<br>板及反光镜等）所使用的机件是相同的。机件装配起来的模型随时可配置，且易于改变</p>
</blockquote>
<p>因为抽象工厂模式是工厂方法模式的一种泛化，所以它能提供相同的好处：让对象的创建更容易追踪；将对象创建与使用解耦；提供优化内存占用和应用性能的潜力。这样会产生一个问题：我们怎么知道何时该使用工厂方法，何时又该使用抽象工厂？答案是，通常一开始时使用工厂方法，因为它更简单。如果后来发现应用需要许多工厂方法，那么将创建一系列对象的过程合并在一起更合理，从而最终引入抽象工厂。<br>抽象工厂有一个优点，在使用工厂方法时从用户视角通常是看不到的，那就是抽象工厂能够通过改变激活的工厂方法动态地（运行时）改变应用行为。</p>
<p>代码示例如下(来自于《精通python设计模式》)：<br>这段代码就是使用了游戏进入前，可以选择不同的难度一样（这里为小孩和大人），选择完后game就有对应的类，小孩的类的方法和大人的类的方法执行着不同的操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Frog</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span><br>        self.name = name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interact_with</span>(<span class="hljs-params">self, obstacle</span>):</span><br>        print(<span class="hljs-string">&#x27;&#123;&#125; the Frog encounters &#123;&#125; and &#123;&#125;!&#x27;</span>.<span class="hljs-built_in">format</span>(self,<br>                                                         obstacle, obstacle.action()))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bug</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;a bug&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">action</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;eats it&#x27;</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FrogWorld</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span><br>        print(self)<br>        self.player_name = name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;\n\n\t------ Frog World ———&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_character</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> Frog(self.player_name)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_obstacle</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> Bug()<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Wizard</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span><br>        self.name = name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">interact_with</span>(<span class="hljs-params">self, obstacle</span>):</span><br>        print(<span class="hljs-string">&#x27;&#123;&#125; the Wizard battles against &#123;&#125; and &#123;&#125;!&#x27;</span>.<span class="hljs-built_in">format</span>(self, obstacle, obstacle.action()))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Ork</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;an evil ork&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">action</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;kills it&#x27;</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WizardWorld</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span><br>        print(self)<br>        self.player_name = name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;\n\n\t------ Wizard World ———&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_character</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> Wizard(self.player_name)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_obstacle</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> Ork()<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GameEnvironment</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, factory</span>):</span><br>        self.hero = factory.make_character()<br>        self.obstacle = factory.make_obstacle()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">play</span>(<span class="hljs-params">self</span>):</span><br>        self.hero.interact_with(self.obstacle)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validate_age</span>(<span class="hljs-params">name</span>):</span><br>    <span class="hljs-keyword">try</span>:<br>        age = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;Welcome &#123;&#125;. How old are you? &#x27;</span>.<span class="hljs-built_in">format</span>(name))<br>        age = <span class="hljs-built_in">int</span>(age)<br>    <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> err:<br>        print(<span class="hljs-string">&quot;Age &#123;&#125; is invalid, please try \</span><br><span class="hljs-string">        again…&quot;</span>.<span class="hljs-built_in">format</span>(age))<br>        <span class="hljs-keyword">return</span> (<span class="hljs-literal">False</span>, age)<br>    <span class="hljs-keyword">return</span> (<span class="hljs-literal">True</span>, age)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Hello. What&#x27;s your name? &quot;</span>)<br>    valid_input = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> valid_input:<br>        valid_input, age = validate_age(name)<br>    game = FrogWorld <span class="hljs-keyword">if</span> age &lt; <span class="hljs-number">18</span> <span class="hljs-keyword">else</span> WizardWorld<br>    environment = GameEnvironment(game(name))<br>    environment.play()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><blockquote>
<p>在它的核心结构中只包含一个被称为单例的特殊类。通过单例模式可以保证系统中，应用该模式的类一个类只有一个实例。即一个类只有一个对象实例</p>
</blockquote>
<blockquote>
<p>单例模式的要点有三个；一是某个类只能有一个实例；二是它必须自行创建这个实例；三是它必须自行向整个系统提供这个实例。<br>从具体实现角度来说，就是以下三点：一是单例模式的类只提供私有的构造函数，二是类定义中含有一个该类的静态私有对象，三是该类提供了一个静态的公有的函数用于创建或获取它本身的静态私有对象。</p>
</blockquote>
<blockquote>
<p>对于系统中的某些类来说，只有一个实例很重要，例如，一个系统中可以存在多个打印任务，但是只能有一个正在工作的任务；一个系统只能有一个窗口管理器或文件系统；一个系统只能有一个计时工具或ID(序号)生成器。如在Windows中就只能打开一个任务管理器。如果不使用机制对窗口对象进行唯一化，将弹出多个窗口，如果这些窗口显示的内容完全一致，则是重复对象，浪费内存资源；如果这些窗口显示的内容不一致，则意味着在某一瞬间系统有多个状态，与实际不符，也会给用户带来误解，不知道哪一个才是真实的状态。因此有时确保系统中某个对象的唯一性即一个类只能有一个实例非常重要。[3]<br>如何保证一个类只有一个实例并且这个实例易于被访问呢？定义一个全局变量可以确保对象随时都可以被访问，但不能防止我们实例化多个对象。一个更好的解决办法是让类自身负责保存它的唯一实例。这个类可以保证没有其他实例被创建，并且它可以提供一个访问该实例的方法。这就是单例模式的模式动机。</p>
</blockquote>
<p>示例代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    __instance=<span class="hljs-literal">None</span><br>    def__init__(self):<br>        <span class="hljs-keyword">pass</span><br>    def__new__(cls,*args,**kwd):<br>        <span class="hljs-keyword">if</span> Singleton.__instance <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            Singleton.__instance=<span class="hljs-built_in">object</span>.__new__(cls,*args,**kwd)<br>        <span class="hljs-keyword">return</span> Singleton.__instance<br></code></pre></td></tr></table></figure>
<p>python中__new__是在__init__之前执行的，用于创建示例，使用__instance来判断这个实例是否被创建，从而限制只有单例</p>
<p>这样使用的单例模式只能对自己的类进行限制，也不灵活。可以使用装饰器实现的单例模式，以达到灵活使用:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Singleton</span>(<span class="hljs-params">cls</span>):</span>  <br>    _instance = &#123;&#125;  <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_singleton</span>(<span class="hljs-params">*args, **kargs</span>):</span>  <br>        <span class="hljs-keyword">if</span> cls <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> _instance:  <br>            _instance[cls] = cls(*args, **kargs)  <br>        <span class="hljs-keyword">return</span> _instance[cls]  <br>    <span class="hljs-keyword">return</span> _singleton  <br> <br> <br><span class="hljs-meta">@Singleton  </span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span>  <br>    a = <span class="hljs-number">1</span>  <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, x = <span class="hljs-number">0</span></span>):</span>  <br>        self.x = x  <br>  <br>  <br>a1 = A(<span class="hljs-number">2</span>)  <br>a2 = A(<span class="hljs-number">3</span>)  <br><span class="hljs-built_in">print</span> <span class="hljs-built_in">id</span>(a1)  <br><span class="hljs-built_in">print</span> <span class="hljs-built_in">id</span>(a2)  <br>print(a1.x)  <br>print(a2.x)  <br></code></pre></td></tr></table></figure>
<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><p>原型模式的应用就像在github等版本管理器一样，有个人po上段代码后，别人可以copy他，并进行修改，这时是一个副本而不是上传者po的代码，上传者也可以new一个分支来修改。<br>其实就像生活中的有丝分裂一样，在复制一份后，两份的改变不互相影响</p>
<p>示例代码如下(来自于《精通python设计模式》)：<br>代码中是在说一本书，发布第二版后的改变，如年代，字数，价格等</p>
<p>注意：<br>浅副本（copy.copy()）和深副本（copy.deepcopy()）之间的区别</p>
<ul>
<li><p>浅副本构造一个新的复合对象后，（会尽可能地）将在原始对象中找到的对象的引用插入<br>新对象中。</p>
</li>
<li><p>深副本构造一个新的复合对象后，会递归地将在原始对象中找到的对象的副本插入新对<br>象中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding: utf-8</span><br><br><span class="hljs-keyword">import</span> copy<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name, authors, price, **rest</span>):</span><br>        <span class="hljs-string">&#x27;&#x27;&#x27;rest的例子有：出版商，长度，标签，出版日期&#x27;&#x27;&#x27;</span><br>        self.name = name<br>        self.authors = authors<br>        self.price = price      <span class="hljs-comment"># 单位为美元</span><br>        self.__dict__.update(rest)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        mylist = []<br>        ordered = OrderedDict(<span class="hljs-built_in">sorted</span>(self.__dict__.items()))<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> ordered.keys():<br>            mylist.append(<span class="hljs-string">&#x27;&#123;&#125;: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(i, ordered[i]))<br>            <span class="hljs-keyword">if</span> i == <span class="hljs-string">&#x27;price&#x27;</span>:<br>                mylist.append(<span class="hljs-string">&#x27;$&#x27;</span>)<br>            mylist.append(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(mylist)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Prototype</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.objects = <span class="hljs-built_in">dict</span>()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span>(<span class="hljs-params">self, identifier, obj</span>):</span><br>        self.objects[identifier] = obj<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unregister</span>(<span class="hljs-params">self, identifier</span>):</span><br>        <span class="hljs-keyword">del</span> self.objects[identifier]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">clone</span>(<span class="hljs-params">self, identifier, **attr</span>):</span><br>        found = self.objects.get(identifier)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> found:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Incorrect object identifier: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(identifier))<br>        obj = copy.deepcopy(found)<br>        obj.__dict__.update(attr)<br>        <span class="hljs-keyword">return</span> obj<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    b1 = Book(<span class="hljs-string">&#x27;The C Programming Language&#x27;</span>, (<span class="hljs-string">&#x27;Brian W. Kernighan&#x27;</span>, <span class="hljs-string">&#x27;Dennis M.Ritchie&#x27;</span>), price=<span class="hljs-number">118</span>, publisher=<span class="hljs-string">&#x27;Prentice Hall&#x27;</span>,<br>              length=<span class="hljs-number">228</span>, publication_date=<span class="hljs-string">&#x27;1978-02-22&#x27;</span>, tags=(<span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;programming&#x27;</span>, <span class="hljs-string">&#x27;algorithms&#x27;</span>, <span class="hljs-string">&#x27;data structures&#x27;</span>))<br><br>    prototype = Prototype()<br>    cid = <span class="hljs-string">&#x27;k&amp;r-first&#x27;</span><br>    prototype.register(cid, b1)<br>    b2 = prototype.clone(cid, name=<span class="hljs-string">&#x27;The C Programming Language(ANSI)&#x27;</span>, price=<span class="hljs-number">48.99</span>,<br>                         length=<span class="hljs-number">274</span>, publication_date=<span class="hljs-string">&#x27;1988-04-01&#x27;</span>, edition=<span class="hljs-number">2</span>)<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (b1, b2):<br>        print(i)<br>    print(<span class="hljs-string">&#x27;ID b1 : &#123;&#125; != ID b2 : &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">id</span>(b1), <span class="hljs-built_in">id</span>(b2)))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<h2 id="结构型模式"><a href="#结构型模式" class="headerlink" title="结构型模式"></a>结构型模式</h2><h3 id="适配器模式（-）"><a href="#适配器模式（-）" class="headerlink" title="适配器模式（*）"></a>适配器模式（*）</h3><p>适配器模式就像是苹果最近出的macbook和iphone8他们的接口使得线无法一起使用，这时，他们就造出了接口转换器，又能多赚点钱了，美滋滋。比如之前有个已经做好的项目了，现在想把另外一个写好的代码当做组件融入项目里，但由于之前没有规划好，这时候就要运用适配器模式，写个适配代码，让这段代码能在项目中运行。但这个时候要遵守2个原则：</p>
</li>
<li><p>不要求访问他方接口的源代码</p>
</li>
<li><p>不违反开放/封闭原则</p>
</li>
</ul>
<blockquote>
<p>适配器模式（Adapter pattern）是一种结构型设计模式，帮助我们实现两个不兼容接口之间的兼容。首先，解释一下不兼容接口的真正含义。如果我们希望把一个老组件用于一个新系统中，或者把一个新组件用于一个老系统中，不对代码进行任何修改两者就能够通信的情况很少见。但又并非总是能修改代码，或因为我们无法访问这些代码（例如，组件以外部库的方式提供），或因为修改代码本身就不切实际。在这些情况下，我们可以编写一个额外的代码层，该代码层包含让两个接口之间能够通信需要进行的所有修改。这个代码层就叫适配器</p>
</blockquote>
<p>示例代码如下(来自于《精通python设计模式》)：<br>第二部分是组件，第一部分的Adapter为适配器，适配器使用字典进行封装，虽然执行了execute方法，但在Synthesizer和Human中，对应执行的却是play和speak，但客户端不care这些，客户端仅知道如何调用execute()方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> external <span class="hljs-keyword">import</span> Synthesizer, Human<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Computer</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span><br>        self.name = name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;the &#123;&#125; computer&#x27;</span>.<span class="hljs-built_in">format</span>(self.name)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;executes a program&#x27;</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Adapter</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, obj, adapted_methods</span>):</span><br>        self.obj = obj<br>        self.__dict__.update(adapted_methods)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(self.obj)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    objects = [Computer(<span class="hljs-string">&#x27;Asus&#x27;</span>)]<br>    synth = Synthesizer(<span class="hljs-string">&#x27;moog&#x27;</span>)<br>    objects.append(Adapter(synth, <span class="hljs-built_in">dict</span>(execute=synth.play)))<br>    human = Human(<span class="hljs-string">&#x27;Bob&#x27;</span>)<br>    objects.append(Adapter(human, <span class="hljs-built_in">dict</span>(execute=human.speak)))<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> objects:<br>        print(<span class="hljs-string">&#x27;&#123;&#125; &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">str</span>(i), i.execute()))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Synthesizer</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span><br>        self.name = name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;the &#123;&#125; synthesizer&#x27;</span>.<span class="hljs-built_in">format</span>(self.name)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">play</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;is playing an electronic song&#x27;</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Human</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span><br>        self.name = name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#123;&#125; the human&#x27;</span>.<span class="hljs-built_in">format</span>(self.name)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">speak</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;says hello&#x27;</span><br><br></code></pre></td></tr></table></figure>
<h3 id="修饰器模式（-）"><a href="#修饰器模式（-）" class="headerlink" title="修饰器模式（*）"></a>修饰器模式（*）</h3><p>修饰器模式和Python修饰器之间并不是一对一的等价关系</p>
<h4 id="修饰器模式"><a href="#修饰器模式" class="headerlink" title="修饰器模式"></a>修饰器模式</h4><p>修饰器就像单反/微单一样。一开始买来时，大家都会选择带上自带的狗头。如果要去拍人像的话，就会换上一个大光圈的定焦头。如果要取拍星星，打鸟，就会换上长焦距镜头。如果要拍微距的话，就可以换一个微距镜头。其中，机身为修饰器模式中要修饰的部分，而镜头就是修饰器。</p>
<blockquote>
<p>在许多编程语言中，使用子类化（继承）来实现修饰器模式在Python中，我们可以（并且应该）使用内置的修饰器特性。一个Python修饰器就是对Python语法的一个特定改变，用于扩展一个类、方法或函数的行为，而无需使用继承。从实现的角度来说，Python修饰器是一个可调用对象（函数、方法、类），接受一个函数对象fin作为输入，并返回另一 个函 数对象 fout。这意味着可以将任何具有这些属性的可调用对象当作一个修饰器。<br>最常见的python秀时期应该就是内置的，property修饰器让一个方法表现为一个变量。但是修饰器模式和Python修饰器之间并不是一对一的等价关系。 Python修饰器能做的实际上比修饰器模式多得多，其中之一就是实现修饰器模式</p>
</blockquote>
<p>这里的内容主要是我阅读完《python编程实战后整理的》<br>首先是原型函数，用来计算平均值的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mean</span>(<span class="hljs-params">first,second, *rest</span>):</span><br>    numbers = (first, second) + rest<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(numbers)/<span class="hljs-built_in">len</span>(numbers)<br></code></pre></td></tr></table></figure>
<p>还有一个修饰函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">float_args_and_return</span>(<span class="hljs-params">functiong</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):</span><br>        args = [<span class="hljs-built_in">float</span>(arg) <span class="hljs-keyword">for</span> arg <span class="hljs-keyword">in</span> args]<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>(function(*args, **kwargs))<br>    <span class="hljs-keyword">return</span> wrapper<br></code></pre></td></tr></table></figure>
<p>通过修饰器模式使用该语句就可以完成</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">mean = float_args_and_return(mean)<br></code></pre></td></tr></table></figure>
<p>在python中可以使用@语法糖来解决，由于在修饰函数中，使用这样的写法，那么修饰后的函数的__name__属性就和原函数不用了（变成了”wrapper”），而且即便原函数有docstring,修饰后的函数也不会有了。这时加上python标准库提供的@functools.wraps修饰器，我们就可以确保修改后的属性和名称与原函数相同<br>即代码如下：<br>可以发现str和int在修饰器后，都可以互相计算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> functools<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">float_args_and_return</span>(<span class="hljs-params">function</span>):</span><br><span class="hljs-meta">    @functools.wraps(<span class="hljs-params">function</span>)</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):</span><br>        args = [<span class="hljs-built_in">float</span>(arg) <span class="hljs-keyword">for</span> arg <span class="hljs-keyword">in</span> args]<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>(function(*args, **kwargs))<br>    <span class="hljs-keyword">return</span> wrapper<br><br><span class="hljs-meta">@float_args_and_return</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mean</span>(<span class="hljs-params">first,second, *rest</span>):</span><br>    numbers = (first, second) + rest<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(numbers)/<span class="hljs-built_in">len</span>(numbers)<br><br>print(mean(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>))<br>print(mean(<span class="hljs-number">3</span>,<span class="hljs-string">&quot;4&quot;</span>,<span class="hljs-number">6</span>))<br></code></pre></td></tr></table></figure>
<h4 id="修饰器工厂"><a href="#修饰器工厂" class="headerlink" title="修饰器工厂"></a>修饰器工厂</h4><p>先看代码：<br>该例子只是用来描述python的灵活性以及创建修饰器工厂的可行性，实际中这样用不太python</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> functools<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">statically_typed</span>(<span class="hljs-params">*types, return_type=<span class="hljs-literal">None</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decorator</span>(<span class="hljs-params">function</span>):</span><br><span class="hljs-meta">        @functools.wraps(<span class="hljs-params">function</span>)</span><br>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):</span><br>            <span class="hljs-comment">#判断传入参数是否超过定义的参数</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) &gt; <span class="hljs-built_in">len</span>(types):                                   <br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;too many arguments&quot;</span>)<br>            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(args) &lt; <span class="hljs-built_in">len</span>(types):<br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;too few arguments&quot;</span>)<br>            <span class="hljs-comment">#判断传入参数类型是否为指定参数类型</span><br>            <span class="hljs-keyword">for</span> i, (arg, type_) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(args, types)):<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(arg, type_):<br>                    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;argument &#123;&#125; must be of type &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(i, type_.__name__))<br>            <span class="hljs-comment">#返回的结果</span><br>            result = function(*args, **kwargs)<br>            <span class="hljs-comment">#判断是否指定返回参数类型以及返回的参数类型是否为制定的参数类型</span><br>            <span class="hljs-keyword">if</span>(return_type <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(result, return_type)):<br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;return value must be of type &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(return_type.__name__))<br>            <span class="hljs-keyword">return</span> result<br>        <span class="hljs-keyword">return</span> wrapper<br>    <span class="hljs-keyword">return</span> decorator<br><br><span class="hljs-meta">@statically_typed(<span class="hljs-params"><span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>, return_type=<span class="hljs-built_in">str</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_tagged</span>(<span class="hljs-params">text, tag</span>):</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&lt;&#123;0&#125;&gt;&#123;1&#125;&lt;/&#123;0&#125;&gt;&quot;</span>.<span class="hljs-built_in">format</span>(tag, text)<br><span class="hljs-meta">@statically_typed(<span class="hljs-params"><span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>, <span class="hljs-built_in">str</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">repeat</span>(<span class="hljs-params">what, count, separator</span>):</span><br>    <span class="hljs-keyword">return</span>((what + separator) * count)[:-<span class="hljs-built_in">len</span>(separator)]<br><br>print(make_tagged(<span class="hljs-string">&quot;Aaa&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>))<br>print(repeat(<span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-number">4</span>, <span class="hljs-string">&quot;6&quot;</span>))<br></code></pre></td></tr></table></figure>
<p>可以看出statically_typed()里面很乱很乱。。。。。<br>然而这个函数并不是修饰器，而是修饰器工厂，也就是一种能制作修饰器的函数。当想用一套模板来制造修饰器时。可以使用这种方法。<br>正如起名修饰器工厂，这里是遵循工程模式来创建修饰器函数的</p>
<h4 id="类修饰器"><a href="#类修饰器" class="headerlink" title="类修饰器"></a>类修饰器</h4><p>类修饰器，也就是对类的修饰器。<br>下面的例子是书的类，Book()的实习都要重复使用getter与setter.可以通过类修饰器来减少重复使用<br>代码如下：<br>不过要注意以下几点</p>
<ul>
<li>代码中，3个修饰器执行时，是从下往上执行</li>
<li>is_non_empty_str()，is_in_range()是用于验证的验证器</li>
<li>在修饰器ensure中传入的分别是实例需要的属性分别为名字，函数，和doc</li>
<li>decorator()中的getter是用来返回保存在私有atttribute的值也就是属性的名字，setter()中的setattr用来设置实例属性的值</li>
<li>而这两个则是通过decorator的setattr来绑定类的实例和实例的值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> functools<br><span class="hljs-keyword">import</span> numbers<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_non_empty_str</span>(<span class="hljs-params">name, value</span>):</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">str</span>):<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;&#123;&#125; must be of type str&quot;</span>.<span class="hljs-built_in">format</span>(name))<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">bool</span>(value):<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;&#123;&#125; may not be empty&quot;</span>.<span class="hljs-built_in">format</span>(name))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_in_range</span>(<span class="hljs-params">minimum=<span class="hljs-literal">None</span>, maximum=<span class="hljs-literal">None</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_in_range</span>(<span class="hljs-params">name, value</span>):</span><br>        <span class="hljs-comment">#numbers.Number用于确保该参数为数字</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, numbers.Number):<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;&#123;&#125; must be a number&quot;</span>.<span class="hljs-built_in">format</span>(name))<br>        <span class="hljs-keyword">if</span> minimum <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> value &lt; minimum:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;&#123;&#125; &#123;&#125; is too small&quot;</span>.<span class="hljs-built_in">format</span>(name, value))<br>        <span class="hljs-keyword">if</span> maximum <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> value &gt; maximum:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;&#123;&#125; &#123;&#125; is too big&quot;</span>.<span class="hljs-built_in">format</span>(name, value))<br>    <span class="hljs-keyword">return</span> is_in_range<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ensure</span>(<span class="hljs-params">name, validate, doc=<span class="hljs-literal">None</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decorator</span>(<span class="hljs-params">Class</span>):</span><br>        privateName = <span class="hljs-string">&quot;_&quot;</span> + name<br>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getter</span>(<span class="hljs-params">self</span>):</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">getattr</span>(self, privateName)<br>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setter</span>(<span class="hljs-params">self, value</span>):</span><br>            validate(name, value)<br>            <span class="hljs-built_in">setattr</span>(self, privateName, value)<br>        <span class="hljs-built_in">setattr</span>(Class, name, <span class="hljs-built_in">property</span>(getter, setter, doc=doc))<br>        <span class="hljs-keyword">return</span> Class<br>    <span class="hljs-keyword">return</span> decorator<br><br><span class="hljs-meta">@ensure(<span class="hljs-params"><span class="hljs-string">&quot;title&quot;</span>, is_non_empty_str</span>)</span><br><span class="hljs-meta">@ensure(<span class="hljs-params"><span class="hljs-string">&quot;price&quot;</span>, is_in_range(<span class="hljs-params"><span class="hljs-number">1</span>, <span class="hljs-number">10000</span></span>)</span>)</span><br><span class="hljs-meta">@ensure(<span class="hljs-params"><span class="hljs-string">&quot;quantity&quot;</span>, is_in_range(<span class="hljs-params"><span class="hljs-number">0</span>, <span class="hljs-number">1000000</span></span>)</span>)</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, title,  price, quantity</span>):</span><br>        self.title = title<br>        self.price = price<br>        self.quantity = quantity<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">value</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.price * self.quantity<br><br>A = Book(<span class="hljs-string">&quot;english&quot;</span>,<span class="hljs-number">60</span>,<span class="hljs-number">3</span>)<br>print(A.value)       <span class="hljs-comment"># 180</span><br>print(A.price)       <span class="hljs-comment"># 60</span><br>print(A._title)      <span class="hljs-comment"># english</span><br></code></pre></td></tr></table></figure>
<p>优化后的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> functools<br><span class="hljs-keyword">import</span> numbers<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_non_empty_str</span>(<span class="hljs-params">name, value</span>):</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">str</span>):<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;&#123;&#125; must be of type str&quot;</span>.<span class="hljs-built_in">format</span>(name))<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">bool</span>(value):<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;&#123;&#125; may not be empty&quot;</span>.<span class="hljs-built_in">format</span>(name))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_in_range</span>(<span class="hljs-params">minimum=<span class="hljs-literal">None</span>, maximum=<span class="hljs-literal">None</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">is_in_range</span>(<span class="hljs-params">name, value</span>):</span><br>        <span class="hljs-comment">#numbers.Number用于确保该参数为数字</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, numbers.Number):<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;&#123;&#125; must be a number&quot;</span>.<span class="hljs-built_in">format</span>(name))<br>        <span class="hljs-keyword">if</span> minimum <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> value &lt; minimum:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;&#123;&#125; &#123;&#125; is too small&quot;</span>.<span class="hljs-built_in">format</span>(name, value))<br>        <span class="hljs-keyword">if</span> maximum <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> value &gt; maximum:<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;&#123;&#125; &#123;&#125; is too big&quot;</span>.<span class="hljs-built_in">format</span>(name, value))<br>    <span class="hljs-keyword">return</span> is_in_range<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Ensure</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, validate, doc=<span class="hljs-literal">None</span></span>):</span><br>        self.validate = validate<br>        self.doc= doc<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">do_ensure</span>(<span class="hljs-params">Class</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_property</span>(<span class="hljs-params">name, attribute</span>):</span><br>        privateName = <span class="hljs-string">&quot;_&quot;</span> + name<br>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getter</span>(<span class="hljs-params">self</span>):</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">getattr</span>(self, privateName)<br>        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setter</span>(<span class="hljs-params">self, value</span>):</span><br>            attribute.validate(name, value)<br>            <span class="hljs-built_in">setattr</span>(self, privateName, value)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">property</span>(getter, setter, doc=attribute.doc)<br>    <span class="hljs-keyword">for</span> name, attribute <span class="hljs-keyword">in</span> Class.__dict__.items():<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(attribute, Ensure):<br>            <span class="hljs-built_in">setattr</span>(Class, name, make_property(name, attribute))<br>    <span class="hljs-keyword">return</span> Class<br><br><span class="hljs-meta">@do_ensure</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">do_Book</span>:</span><br><br>    title = Ensure(is_non_empty_str)<br>    price = Ensure(is_in_range(<span class="hljs-number">1</span>, <span class="hljs-number">10000</span>))<br>    quantity = Ensure(is_in_range(<span class="hljs-number">0</span>, <span class="hljs-number">1000000</span>))<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, title,  price, quantity</span>):</span><br>        self.title = title<br>        self.price = price<br>        self.quantity = quantity<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">value</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.price * self.quantity<br><br><br>B = do_Book(<span class="hljs-string">&quot;english&quot;</span>,<span class="hljs-number">60</span>,<span class="hljs-number">3</span>)<br>print(B.value)<br>print(B.price)<br>print(B._title)<br><br></code></pre></td></tr></table></figure>
<h3 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h3><p>在客户端代码想要使用一个复杂系统但又不关心系统复杂性之时，外观模式是为复杂系统提供一个简单接口的理想方式。一台计算机是一个外观，因为当我们使用它时需要做的事情仅是按一个按钮来启动它；其余的所有硬件复杂性都用户无感知地交由BIOS、引导加载程序以及其他系统软件来处理。</p>
<p>示例代码如下(来自于《精通python设计模式》)： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding: utf-8</span><br><br><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum<br><span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABCMeta, abstractmethod<br><br>State = Enum(<span class="hljs-string">&#x27;State&#x27;</span>, <span class="hljs-string">&#x27;new running sleeping restart zombie&#x27;</span>)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>:</span><br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Process</span>:</span><br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span>:</span><br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Server</span>(<span class="hljs-params">metaclass=ABCMeta</span>):</span><br><br><span class="hljs-meta">    @abstractmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.name<br><br><span class="hljs-meta">    @abstractmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">boot</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-meta">    @abstractmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kill</span>(<span class="hljs-params">self, restart=<span class="hljs-literal">True</span></span>):</span><br>        <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileServer</span>(<span class="hljs-params">Server</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-string">&#x27;&#x27;&#x27;初始化文件服务进程要求的操作&#x27;&#x27;&#x27;</span><br>        self.name = <span class="hljs-string">&#x27;FileServer&#x27;</span><br>        self.state = State.new<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">boot</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;booting the &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self))<br>        <span class="hljs-string">&#x27;&#x27;&#x27;启动文件服务进程要求的操作&#x27;&#x27;&#x27;</span><br>        self.state = State.running<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kill</span>(<span class="hljs-params">self, restart=<span class="hljs-literal">True</span></span>):</span><br>        print(<span class="hljs-string">&#x27;Killing &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self))<br>        <span class="hljs-string">&#x27;&#x27;&#x27;杀死文件服务进程要求的操作&#x27;&#x27;&#x27;</span><br>        self.state = State.restart <span class="hljs-keyword">if</span> restart <span class="hljs-keyword">else</span> State.zombie<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_file</span>(<span class="hljs-params">self, user, name, permissions</span>):</span><br>        <span class="hljs-string">&#x27;&#x27;&#x27;检查访问权限的有效性、用户权限，等等&#x27;&#x27;&#x27;</span><br><br>        print(<span class="hljs-string">&quot;trying to create the file &#x27;&#123;&#125;&#x27; for user &#x27;&#123;&#125;&#x27; with permissions &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(name, user, permissions))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ProcessServer</span>(<span class="hljs-params">Server</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-string">&#x27;&#x27;&#x27;初始化进程服务进程要求的操作&#x27;&#x27;&#x27;</span><br>        self.name = <span class="hljs-string">&#x27;ProcessServer&#x27;</span><br>        self.state = State.new<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">boot</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;booting the &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self))<br>        <span class="hljs-string">&#x27;&#x27;&#x27;启动进程服务进程要求的操作&#x27;&#x27;&#x27;</span><br>        self.state = State.running<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">kill</span>(<span class="hljs-params">self, restart=<span class="hljs-literal">True</span></span>):</span><br>        print(<span class="hljs-string">&#x27;Killing &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self))<br>        <span class="hljs-string">&#x27;&#x27;&#x27;杀死进程服务进程要求的操作&#x27;&#x27;&#x27;</span><br>        self.state = State.restart <span class="hljs-keyword">if</span> restart <span class="hljs-keyword">else</span> State.zombie<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_process</span>(<span class="hljs-params">self, user, name</span>):</span><br>        <span class="hljs-string">&#x27;&#x27;&#x27;检查用户权限、生成PID，等等&#x27;&#x27;&#x27;</span><br><br>        print(<span class="hljs-string">&quot;trying to create the process &#x27;&#123;&#125;&#x27; for user &#x27;&#123;&#125;&#x27;&quot;</span>.<span class="hljs-built_in">format</span>(name, user))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WindowServer</span>:</span><br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NetworkServer</span>:</span><br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OperatingSystem</span>:</span><br><br>    <span class="hljs-string">&#x27;&#x27;&#x27;外观&#x27;&#x27;&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.fs = FileServer()<br>        self.ps = ProcessServer()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">start</span>(<span class="hljs-params">self</span>):</span><br>        [i.boot() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> (self.fs, self.ps)]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_file</span>(<span class="hljs-params">self, user, name, permissions</span>):</span><br>        <span class="hljs-keyword">return</span> self.fs.create_file(user, name, permissions)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_process</span>(<span class="hljs-params">self, user, name</span>):</span><br>        <span class="hljs-keyword">return</span> self.ps.create_process(user, name)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    os = OperatingSystem()<br>    os.start()<br>    os.create_file(<span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-string">&#x27;-rw-r-r&#x27;</span>)<br>    os.create_process(<span class="hljs-string">&#x27;bar&#x27;</span>, <span class="hljs-string">&#x27;ls /tmp&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<h3 id="享元模式（-）"><a href="#享元模式（-）" class="headerlink" title="享元模式（*）"></a>享元模式（*）</h3><p>由于对象创建的开销，面向对象的系统可能会面临性能问题。所以有了享元模式，享元模式可以让多个单元一起共享同一个需要的数据。类似于玩游戏时，每个人其实都差不多，只是表情或者帽子等有差别，那些没差别的部位可以来自同一个对象，减少内存开销</p>
<p>示例代码如下(来自于《精通python设计模式》)：<br>代码中，通过__new__的方式和pool限制了只创建了三个对象，通过输出，可以看出虽然生产了30课树，但除了年龄，位置外，其余的属性都是这三个对象的其中一个</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding: utf-8</span><br><br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum<br><br>TreeType = Enum(<span class="hljs-string">&#x27;TreeType&#x27;</span>, <span class="hljs-string">&#x27;apple_tree cherry_tree peach_tree&#x27;</span>)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tree</span>:</span><br>    pool = <span class="hljs-built_in">dict</span>()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__new__</span>(<span class="hljs-params">cls, tree_type</span>):</span><br>        obj = cls.pool.get(tree_type, <span class="hljs-literal">None</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> obj:<br>            obj = <span class="hljs-built_in">object</span>.__new__(cls)<br>            cls.pool[tree_type] = obj<br>            obj.tree_type = tree_type<br>        <span class="hljs-keyword">return</span> obj<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">render</span>(<span class="hljs-params">self, age, x, y</span>):</span><br>        print(<span class="hljs-string">&#x27;render a tree of type &#123;&#125; and age &#123;&#125; at (&#123;&#125;, &#123;&#125;)&#x27;</span>.<span class="hljs-built_in">format</span>(self.tree_type, age, x, y))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    rnd = random.Random()<br>    age_min, age_max = <span class="hljs-number">1</span>, <span class="hljs-number">30</span>    <span class="hljs-comment"># 单位为年</span><br>    min_point, max_point = <span class="hljs-number">0</span>, <span class="hljs-number">100</span><br>    tree_counter = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        t1 = Tree(TreeType.apple_tree)<br>        t1.render(rnd.randint(age_min, age_max),<br>                  rnd.randint(min_point, max_point),<br>                  rnd.randint(min_point, max_point))<br>        tree_counter += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        t2 = Tree(TreeType.cherry_tree)<br>        t2.render(rnd.randint(age_min, age_max),<br>                  rnd.randint(min_point, max_point),<br>                  rnd.randint(min_point, max_point))<br>        tree_counter += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        t3 = Tree(TreeType.peach_tree)<br>        t3.render(rnd.randint(age_min, age_max),<br>                  rnd.randint(min_point, max_point),<br>                  rnd.randint(min_point, max_point))<br>        tree_counter += <span class="hljs-number">1</span><br><br>    print(<span class="hljs-string">&#x27;trees rendered: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(tree_counter))<br>    print(<span class="hljs-string">&#x27;trees actually created: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(Tree.pool)))<br><br>    t4 = Tree(TreeType.cherry_tree)<br>    t5 = Tree(TreeType.cherry_tree)<br>    t6 = Tree(TreeType.apple_tree)<br>    print(<span class="hljs-string">&#x27;&#123;&#125; == &#123;&#125;? &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">id</span>(t4), <span class="hljs-built_in">id</span>(t5), <span class="hljs-built_in">id</span>(t4) == <span class="hljs-built_in">id</span>(t5)))<br>    print(<span class="hljs-string">&#x27;&#123;&#125; == &#123;&#125;? &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">id</span>(t5), <span class="hljs-built_in">id</span>(t6), <span class="hljs-built_in">id</span>(t5) == <span class="hljs-built_in">id</span>(t6)))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<h3 id="模型-视图-控制器模式（-）"><a href="#模型-视图-控制器模式（-）" class="headerlink" title="模型-视图-控制器模式（*）"></a>模型-视图-控制器模式（*）</h3><p>MVC模式要是有接触到ui的几乎都见过。该模式通过分层设计，把视图和模型分开，再通过控制器把他们联系起来，但视图和模型可以互相不用知道对方如何工作。<br>例如在Django中，view+url为C，model为m，template为V，MVC运行方式如下：</p>
<ul>
<li><p>用户通过单击（键入、触摸等）某个按钮触发一个视图</p>
</li>
<li><p>视图把用户操作告知控制器</p>
</li>
<li><p>控制器处理用户输入，并与模型交互</p>
</li>
<li><p>模型执行所有必要的校验和状态改变，并通知控制器应该做什么</p>
</li>
<li><p>控制器按照模型给出的指令，指导视图适当地更新和显示输出</p>
<Br/>
MVC模式有3个好处</li>
<li><p>视图与模型的分离允许美工一心搞UI部分，程序员一心搞开发，不会相互干扰。</p>
</li>
<li><p>由于视图与模型之间的松耦合，每个部分可以单独修改/扩展，不会相互影响。例如，添加一个新视图的成本很小，只要为其实现一个控制器就可以了。</p>
</li>
<li><p>因为职责明晰，维护每个部分也更简单</p>
<Br/>
创建MVC时要确保：模型很智能，控制器很瘦，视图很傻瓜</li>
<li><p>智能模型</p>
<ul>
<li>包含所有的校验/业务规则/逻辑</li>
<li>处理应用的状态</li>
<li>访问应用数据（数据库、云或其他）</li>
<li>不依赖UI<Br/></li>
</ul>
</li>
<li><p>瘦控制器</p>
<ul>
<li>在用户与视图交互时，更新模型</li>
<li>在模型改变时，更新视图</li>
<li>如果需要，在数据传递给模型/视图之前进行处理</li>
<li>不展示数据</li>
<li>不直接访问应用数据</li>
<li>不包含校验/业务规则/逻辑<Br/></li>
</ul>
</li>
<li><p>傻瓜视图</p>
<ul>
<li>展示数据</li>
<li>允许用户与其交互</li>
<li>仅做最小的数据处理，通常由一种模板语言提供处理能力（例如，使用简单的变量和循环控制）</li>
<li>不存储任何数据</li>
<li>不直接访问应用数据</li>
<li>不包含校验/业务规则/逻辑</li>
</ul>
</li>
</ul>
<p>示例代码如下(来自于《精通python设计模式》)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python">quotes = (<span class="hljs-string">&#x27;A man is not complete until he is married. Then he is finished.&#x27;</span>,<br>          <span class="hljs-string">&#x27;As I said before, I never repeat myself.&#x27;</span>,<br>          <span class="hljs-string">&#x27;Behind a successful man is an exhausted woman.&#x27;</span>,<br>          <span class="hljs-string">&#x27;Black holes really suck...&#x27;</span>, <span class="hljs-string">&#x27;Facts are stubborn things.&#x27;</span>)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuoteModel</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_quote</span>(<span class="hljs-params">self, n</span>):</span><br>        <span class="hljs-keyword">try</span>:<br>            value = quotes[n]<br>        <span class="hljs-keyword">except</span> IndexError <span class="hljs-keyword">as</span> err:<br>            value = <span class="hljs-string">&#x27;Not found!&#x27;</span><br>        <span class="hljs-keyword">return</span> value<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuoteTerminalView</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span>(<span class="hljs-params">self, quote</span>):</span><br>        print(<span class="hljs-string">&#x27;And the quote is: &quot;&#123;&#125;&quot;&#x27;</span>.<span class="hljs-built_in">format</span>(quote))<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">error</span>(<span class="hljs-params">self, msg</span>):</span><br>        print(<span class="hljs-string">&#x27;Error: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(msg))<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">select_quote</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;Which quote number would you like to see?&#x27;</span>)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuoteTerminalController</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.model = QuoteModel()<br>        self.view = QuoteTerminalView()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span><br>        valid_input = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> valid_input:<br>            n = self.view.select_quote()<br>            <span class="hljs-keyword">try</span>:<br>                n = <span class="hljs-built_in">int</span>(n)<br>            <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> err:<br>                self.view.error(<span class="hljs-string">&quot;Incorrect index &#x27;&#123;&#125;&#x27;&quot;</span>.<span class="hljs-built_in">format</span>(n))<br>            <span class="hljs-keyword">else</span>:<br>                valid_input = <span class="hljs-literal">True</span><br>        quote = self.model.get_quote(n)<br>        self.view.show(quote)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    controller = QuoteTerminalController()<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        controller.run()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<h3 id="代理模式（-）"><a href="#代理模式（-）" class="headerlink" title="代理模式（*）"></a>代理模式（*）</h3><p>代理，就是把这个步骤交给其他的去做，然后返回结果。代理模式有很多种：</p>
<ul>
<li>远程代理：实际存在于不同地址空间（例如，某个网络服务器）的对象在本地的代理者。</li>
<li>虚拟代理：用于懒初始化，将一个大计算量对象的创建延迟到真正需要的时候进行。</li>
<li>保护/防护代理：控制对敏感对象的访问。</li>
<li>智能（引用）代理：在对象被访问时执行额外的动作。此类代理的例子包括引用计数和线程安全检查。<Br/>
虚拟代理的应用：
示例代码如下(来自于《精通python设计模式》)：
通过LazyProperty修饰器来达到代理。可以通过输出来理解
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding: utf-8</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LazyProperty</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, method</span>):</span><br>        self.method = method<br>        self.method_name = method.__name__<br>        print(<span class="hljs-string">&#x27;function overriden: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self.method))<br>        print(<span class="hljs-string">&quot;function&#x27;s name: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(self.method_name))<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__get__</span>(<span class="hljs-params">self, obj, cls</span>):</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> obj:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>        value = self.method(obj)<br>        print(<span class="hljs-string">&#x27;value &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(value))<br>        <span class="hljs-built_in">setattr</span>(obj, self.method_name, value)<br>        <span class="hljs-keyword">return</span> value<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.x = <span class="hljs-string">&#x27;foo&#x27;</span><br>        self.y = <span class="hljs-string">&#x27;bar&#x27;</span><br>        self._resource = <span class="hljs-literal">None</span><br><br><span class="hljs-meta">    @LazyProperty</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">resource</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;initializing self._resource which is: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self._resource))<br>        self._resource = <span class="hljs-built_in">tuple</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>))    <span class="hljs-comment"># 代价大的</span><br>        <span class="hljs-keyword">return</span> self._resource<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    t = Test()<br>    print(t.x)<br>    print(t.y)<br>    <span class="hljs-comment"># 做更多的事情。。。</span><br>    print(t.resource)<br>    print(t.resource)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure>
输出部分：
可以从输出部分看到t = Test()时，代理修饰器已经运行了。
第一个print(t.resource) 开始加载，当来到
LazyProperty的value = self.method(obj)语句时，调用到了Text的resource(self)，开始生成数值，取代原先的None并返回给代理。代理使用setattr把数据与method_name绑定，当再次调用print(t.resource)时，调用的是代理的method_name的数据，所以直接返回数据
总结的说，就是在第一次获取数据时，是获取到Test.resource的值（这时才刚加载），并把值存在代理的value里面（所以之后都不用加载Test.resource的值）。加载之后的每次调用，返回的都是代理的value(包括第一调用时返回的值)
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">function overriden: &lt;function Test.resource at <span class="hljs-number">0x7fad622c4d90</span>&gt;<br>function<span class="hljs-string">&#x27;s name: resource</span><br><span class="hljs-string">foo</span><br><span class="hljs-string">bar</span><br><span class="hljs-string">initializing self._resource which is: None</span><br><span class="hljs-string">value (0, 1, 2, 3, 4)</span><br><span class="hljs-string">(0, 1, 2, 3, 4)</span><br><span class="hljs-string">(0, 1, 2, 3, 4)</span><br></code></pre></td></tr></table></figure>
防护代理的应用：
示例代码如下(来自于《精通python设计模式》)：
注：密码不应该明文出现在代码里面，以下代码仅为示例所需
可以从代码看出Info类仅是个代理，调用的数据还是来自于SensitiveInfo类，不过info类多了个密码验证功能，如果不能验证成功，就不会访问到SensitiveInfo类的数据。从而利用代理达到防护数据被窃取的可能
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding: utf-8</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SensitiveInfo</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.users = [<span class="hljs-string">&#x27;nick&#x27;</span>, <span class="hljs-string">&#x27;tom&#x27;</span>, <span class="hljs-string">&#x27;ben&#x27;</span>, <span class="hljs-string">&#x27;mike&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;There are &#123;&#125; users: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(self.users), <span class="hljs-string">&#x27; &#x27;</span>.join(self.users)))<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">self, user</span>):</span><br>        self.users.append(user)<br>        print(<span class="hljs-string">&#x27;Added user &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(user))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Info</span>:</span><br><br>    <span class="hljs-string">&#x27;&#x27;&#x27;SensitiveInfo的保护代理&#x27;&#x27;&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.protected = SensitiveInfo()<br>        self.secret = <span class="hljs-string">&#x27;0xdeadbeef&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>(<span class="hljs-params">self</span>):</span><br>        self.protected.read()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">self, user</span>):</span><br>        sec = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;what is the secret? &#x27;</span>)<br>        self.protected.add(user) <span class="hljs-keyword">if</span> sec == self.secret <span class="hljs-keyword">else</span> print(<span class="hljs-string">&quot;That&#x27;s wrong!&quot;</span>)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    info = Info()<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        print(<span class="hljs-string">&#x27;1. read list |==| 2. add user |==| 3. quit&#x27;</span>)<br>        key = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;choose option: &#x27;</span>)<br>        <span class="hljs-keyword">if</span> key == <span class="hljs-string">&#x27;1&#x27;</span>:<br>            info.read()<br>        <span class="hljs-keyword">elif</span> key == <span class="hljs-string">&#x27;2&#x27;</span>:<br>            name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;choose username: &#x27;</span>)<br>            info.add(name)<br>        <span class="hljs-keyword">elif</span> key == <span class="hljs-string">&#x27;3&#x27;</span>:<br>            exit()<br>        <span class="hljs-keyword">else</span>:<br>            print(<span class="hljs-string">&#x27;unknown option: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(key))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
## 行为型模式
### 责任链模式
责任链模式就像广播网络一样，一台机器发出一个广播，同个本地局域网的其他主机就会开始接收，如果这个数据是自己可以用的，就给自己执行，如果不是就丢给下一个主机。
就像python里面的if....elif...elif....else（我认为这就是责任链模式。。这是我搜索时没有答案可以验证我的这个认为）
>其原则如下所示。
(1) 存在一个对象链（链表、树或任何其他便捷的数据结构）。
(2) 我们一开始将请求发送给链中的第一个对象。
(3) 对象决定其是否要处理该请求。
(4) 对象将请求转发给下一个对象。
(5) 重复该过程，直到到达链尾。

</li>
</ul>
<p>示例代码如下(来自于《精通python设计模式》)：<br>可以通过输出查看事件的显示</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Event</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span><br>        self.name = name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.name<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Widget</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, parent=<span class="hljs-literal">None</span></span>):</span><br>        self.parent = parent<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle</span>(<span class="hljs-params">self, event</span>):</span><br>        handler = <span class="hljs-string">&#x27;handle_&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(event)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(self, handler):<br>            method = <span class="hljs-built_in">getattr</span>(self, handler)<br>            method(event)<br>        <span class="hljs-keyword">elif</span> self.parent:<br>            self.parent.handle(event)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">hasattr</span>(self, <span class="hljs-string">&#x27;handle_default&#x27;</span>):<br>            self.handle_default(event)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainWindow</span>(<span class="hljs-params">Widget</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_close</span>(<span class="hljs-params">self, event</span>):</span><br>        print(<span class="hljs-string">&#x27;MainWindow: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(event))<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_default</span>(<span class="hljs-params">self, event</span>):</span><br>        print(<span class="hljs-string">&#x27;MainWindow Default: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(event))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SendDialog</span>(<span class="hljs-params">Widget</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_paint</span>(<span class="hljs-params">self, event</span>):</span><br>        print(<span class="hljs-string">&#x27;SendDialog: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(event))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MsgText</span>(<span class="hljs-params">Widget</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_down</span>(<span class="hljs-params">self, event</span>):</span><br>        print(<span class="hljs-string">&#x27;MsgText: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(event))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    mw = MainWindow()<br>    sd = SendDialog(mw)<br>    msg = MsgText(sd)<br><br>    <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;down&#x27;</span>, <span class="hljs-string">&#x27;paint&#x27;</span>, <span class="hljs-string">&#x27;unhandled&#x27;</span>, <span class="hljs-string">&#x27;close&#x27;</span>):<br>        evt = Event(e)<br>        print(<span class="hljs-string">&#x27;\nSending event -&#123;&#125;- to MainWindow&#x27;</span>.<span class="hljs-built_in">format</span>(evt))<br>        mw.handle(evt)<br>        print(<span class="hljs-string">&#x27;Sending event -&#123;&#125;- to SendDialog&#x27;</span>.<span class="hljs-built_in">format</span>(evt))<br>        sd.handle(evt)<br>        print(<span class="hljs-string">&#x27;Sending event -&#123;&#125;- to MsgText&#x27;</span>.<span class="hljs-built_in">format</span>(evt))<br>        msg.handle(evt)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><p>命令模式就是通过封装，使代码能够通过一些选项终端运行不一样的功能</p>
<p>示例代码如下(来自于《精通python设计模式》)：<br>通过命令来打开文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br>verbose = <span class="hljs-literal">True</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RenameFile</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, path_src, path_dest</span>):</span><br>        self.src, self.dest = path_src, path_dest<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">if</span> verbose:<br>            print(<span class="hljs-string">&quot;[renaming &#x27;&#123;&#125;&#x27; to &#x27;&#123;&#125;&#x27;]&quot;</span>.<span class="hljs-built_in">format</span>(self.src, self.dest))<br>        os.rename(self.src, self.dest)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">undo</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">if</span> verbose:<br>            print(<span class="hljs-string">&quot;[renaming &#x27;&#123;&#125;&#x27; back to &#x27;&#123;&#125;&#x27;]&quot;</span>.<span class="hljs-built_in">format</span>(self.dest, self.src))<br>        os.rename(self.dest, self.src)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateFile</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, path, txt=<span class="hljs-string">&#x27;hello world\n&#x27;</span></span>):</span><br>        self.path, self.txt = path, txt<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">if</span> verbose:<br>            print(<span class="hljs-string">&quot;[creating file &#x27;&#123;&#125;&#x27;]&quot;</span>.<span class="hljs-built_in">format</span>(self.path))<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(self.path, mode=<span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> out_file:<br>            out_file.write(self.txt)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">undo</span>(<span class="hljs-params">self</span>):</span><br>        delete_file(self.path)<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReadFile</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, path</span>):</span><br>        self.path = path<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">if</span> verbose:<br>            print(<span class="hljs-string">&quot;[reading file &#x27;&#123;&#125;&#x27;]&quot;</span>.<span class="hljs-built_in">format</span>(self.path))<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(self.path, mode=<span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> in_file:<br>            print(in_file.read(), end=<span class="hljs-string">&#x27;&#x27;</span>)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete_file</span>(<span class="hljs-params">path</span>):</span><br>    <span class="hljs-keyword">if</span> verbose:<br>        print(<span class="hljs-string">&quot;deleting file &#x27;&#123;&#125;&#x27;&quot;</span>.<span class="hljs-built_in">format</span>(path))<br>    os.remove(path)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    orig_name, new_name = <span class="hljs-string">&#x27;file1&#x27;</span>, <span class="hljs-string">&#x27;file2&#x27;</span><br><br>    commands = []<br>    <span class="hljs-keyword">for</span> cmd <span class="hljs-keyword">in</span> CreateFile(orig_name), ReadFile(orig_name), RenameFile(orig_name, new_name):<br>        commands.append(cmd)<br><br>    [c.execute() <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> commands]<br><br>    answer = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;reverse the executed commands? [y/n] &#x27;</span>)<br><br>    <span class="hljs-keyword">if</span> answer <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;yY&#x27;</span>:<br>        print(<span class="hljs-string">&quot;the result is &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(new_name))<br>        exit()<br><br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(commands):<br>        <span class="hljs-keyword">try</span>:<br>            c.undo()<br>        <span class="hljs-keyword">except</span> AttributeError <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<h3 id="解释器模式"><a href="#解释器模式" class="headerlink" title="解释器模式"></a>解释器模式</h3><p>封装自己写好的代码，操作者通过命令来调用代码来完成自己想要的操作就是解释器模式所提供的功能<br>很多应用都会提供命令模式，像A家的Ae，Pr，Ps等产品，让操作这个应用的人都能以自己的能力取更好的制作出自己的作品，python有很多命令操作工具包，通过封装能使操作的人按照命令来操作代码。<br>或者说，我们打开一个解释器在运行一段代码时，该解释器就是在利用解释器模式运行我们的代码<br>示例代码如下(来自于《精通python设计模式》)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># coding: utf-8</span><br><br><span class="hljs-keyword">from</span> pyparsing <span class="hljs-keyword">import</span> Word, OneOrMore, Optional, Group, Suppress, alphanums<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Gate</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.is_open = <span class="hljs-literal">False</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;open&#x27;</span> <span class="hljs-keyword">if</span> self.is_open <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;closed&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">open</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;opening the gate&#x27;</span>)<br>        self.is_open = <span class="hljs-literal">True</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">close</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;closing the gate&#x27;</span>)<br>        self.is_open = <span class="hljs-literal">False</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Garage</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.is_open = <span class="hljs-literal">False</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;open&#x27;</span> <span class="hljs-keyword">if</span> self.is_open <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;closed&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">open</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;opening the garage&#x27;</span>)<br>        self.is_open = <span class="hljs-literal">True</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">close</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;closing the garage&#x27;</span>)<br>        self.is_open = <span class="hljs-literal">False</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Aircondition</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.is_on = <span class="hljs-literal">False</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;on&#x27;</span> <span class="hljs-keyword">if</span> self.is_on <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;off&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">turn_on</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;turning on the aircondition&#x27;</span>)<br>        self.is_on = <span class="hljs-literal">True</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">turn_off</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;turning off the aircondition&#x27;</span>)<br>        self.is_on = <span class="hljs-literal">False</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Heating</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.is_on = <span class="hljs-literal">False</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;on&#x27;</span> <span class="hljs-keyword">if</span> self.is_on <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;off&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">turn_on</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;turning on the heating&#x27;</span>)<br>        self.is_on = <span class="hljs-literal">True</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">turn_off</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;turning off the heating&#x27;</span>)<br>        self.is_on = <span class="hljs-literal">False</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Boiler</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.temperature = <span class="hljs-number">83</span>  <span class="hljs-comment"># in celsius</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;boiler temperature: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self.temperature)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">increase_temperature</span>(<span class="hljs-params">self, amount</span>):</span><br>        print(<span class="hljs-string">&quot;increasing the boiler&#x27;s temperature by &#123;&#125; degrees&quot;</span>.<span class="hljs-built_in">format</span>(amount))<br>        self.temperature += amount<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decrease_temperature</span>(<span class="hljs-params">self, amount</span>):</span><br>        print(<span class="hljs-string">&quot;decreasing the boiler&#x27;s temperature by &#123;&#125; degrees&quot;</span>.<span class="hljs-built_in">format</span>(amount))<br>        self.temperature -= amount<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fridge</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.temperature = <span class="hljs-number">2</span>  <span class="hljs-comment"># 单位为摄氏度</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;fridge temperature: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(self.temperature)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">increase_temperature</span>(<span class="hljs-params">self, amount</span>):</span><br>        print(<span class="hljs-string">&quot;increasing the fridge&#x27;s temperature by &#123;&#125; degrees&quot;</span>.<span class="hljs-built_in">format</span>(amount))<br>        self.temperature += amount<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decrease_temperature</span>(<span class="hljs-params">self, amount</span>):</span><br>        print(<span class="hljs-string">&quot;decreasing the fridge&#x27;s temperature by &#123;&#125; degrees&quot;</span>.<span class="hljs-built_in">format</span>(amount))<br>        self.temperature -= amount<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    word = Word(alphanums)<br>    command = Group(OneOrMore(word))<br>    token = Suppress(<span class="hljs-string">&quot;-&gt;&quot;</span>)<br>    device = Group(OneOrMore(word))<br>    argument = Group(OneOrMore(word))<br>    event = command + token + device + Optional(token + argument)<br><br>    gate = Gate()<br>    garage = Garage()<br>    airco = Aircondition()<br>    heating = Heating()<br>    boiler = Boiler()<br>    fridge = Fridge()<br><br>    tests = (<span class="hljs-string">&#x27;open -&gt; gate&#x27;</span>,<br>             <span class="hljs-string">&#x27;close -&gt; garage&#x27;</span>,<br>             <span class="hljs-string">&#x27;turn on -&gt; aircondition&#x27;</span>,<br>             <span class="hljs-string">&#x27;turn off -&gt; heating&#x27;</span>,<br>             <span class="hljs-string">&#x27;increase -&gt; boiler temperature -&gt; 5 degrees&#x27;</span>,<br>             <span class="hljs-string">&#x27;decrease -&gt; fridge temperature -&gt; 2 degrees&#x27;</span>)<br>    open_actions = &#123;<span class="hljs-string">&#x27;gate&#x27;</span>: gate.<span class="hljs-built_in">open</span>,<br>                    <span class="hljs-string">&#x27;garage&#x27;</span>: garage.<span class="hljs-built_in">open</span>,<br>                    <span class="hljs-string">&#x27;aircondition&#x27;</span>: airco.turn_on,<br>                    <span class="hljs-string">&#x27;heating&#x27;</span>: heating.turn_on,<br>                    <span class="hljs-string">&#x27;boiler temperature&#x27;</span>: boiler.increase_temperature,<br>                    <span class="hljs-string">&#x27;fridge temperature&#x27;</span>: fridge.increase_temperature&#125;<br>    close_actions = &#123;<span class="hljs-string">&#x27;gate&#x27;</span>: gate.close,<br>                     <span class="hljs-string">&#x27;garage&#x27;</span>: garage.close,<br>                     <span class="hljs-string">&#x27;aircondition&#x27;</span>: airco.turn_off,<br>                     <span class="hljs-string">&#x27;heating&#x27;</span>: heating.turn_off,<br>                     <span class="hljs-string">&#x27;boiler temperature&#x27;</span>: boiler.decrease_temperature,<br>                     <span class="hljs-string">&#x27;fridge temperature&#x27;</span>: fridge.decrease_temperature&#125;<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> tests:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(event.parseString(t)) == <span class="hljs-number">2</span>:  <span class="hljs-comment"># 没有参数</span><br>            cmd, dev = event.parseString(t)<br>            cmd_str, dev_str = <span class="hljs-string">&#x27; &#x27;</span>.join(cmd), <span class="hljs-string">&#x27; &#x27;</span>.join(dev)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;open&#x27;</span> <span class="hljs-keyword">in</span> cmd_str <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;turn on&#x27;</span> <span class="hljs-keyword">in</span> cmd_str:<br>                open_actions[dev_str]()<br>            <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;close&#x27;</span> <span class="hljs-keyword">in</span> cmd_str <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;turn off&#x27;</span> <span class="hljs-keyword">in</span> cmd_str:<br>                close_actions[dev_str]()<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(event.parseString(t)) == <span class="hljs-number">3</span>:  <span class="hljs-comment"># 有参数</span><br>            cmd, dev, arg = event.parseString(t)<br>            cmd_str, dev_str, arg_str = <span class="hljs-string">&#x27; &#x27;</span>.join(cmd), <span class="hljs-string">&#x27; &#x27;</span>.join(dev), <span class="hljs-string">&#x27; &#x27;</span>.join(arg)<br>            num_arg = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">try</span>:<br>                num_arg = <span class="hljs-built_in">int</span>(arg_str.split()[<span class="hljs-number">0</span>])  <span class="hljs-comment"># 抽取数值部分</span><br>            <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> err:<br>                print(<span class="hljs-string">&quot;expected number but got: &#x27;&#123;&#125;&#x27;&quot;</span>.<span class="hljs-built_in">format</span>(arg_str[<span class="hljs-number">0</span>]))<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;increase&#x27;</span> <span class="hljs-keyword">in</span> cmd_str <span class="hljs-keyword">and</span> num_arg &gt; <span class="hljs-number">0</span>:<br>                open_actions[dev_str](num_arg)<br>            <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;decrease&#x27;</span> <span class="hljs-keyword">in</span> cmd_str <span class="hljs-keyword">and</span> num_arg &gt; <span class="hljs-number">0</span>:<br>                close_actions[dev_str](num_arg)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<h3 id="观察者模式（-）"><a href="#观察者模式（-）" class="headerlink" title="观察者模式（*）"></a>观察者模式（*）</h3><blockquote>
<p>有时，我们希望在一个对象的状态改变时更新另外一组对象。在MVC模式中有这样一个非常常见的例子，假设在两个视图（例如，一个饼图和一个电子表格）中使用同一个模型的数据，无论何时更改了模型，都需要更新两个视图。这就是观察者设计模式要处理的问题。观察者模式描述单个对象（发布者，又称为主持者或可观察者）与一个或多个对象（订阅者，又称为观察者）之间的发布—订阅关系。在MVC例子中，发布者是模型，订阅者是视图。然而，MVC并非是仅有的发布—订阅例子。信息聚合订阅（比如， RSS或Atom）是另一种例子。许多读者通常会使用一个信息聚合阅读器订阅信息流，每当增加一条新信息时，他们就能自动地获取到更新。观察者模式背后的思想等同于MVC和关注点分离原则背后的思想，即降低发布者与订阅者之间的耦合度，从而易于在运行时添加/删除订阅者。此外，发布者不关心它的订阅者是谁。它只是将通知发送给所有订阅者。</p>
</blockquote>
<p>观察者模式经常被用于社交网络，当用户关注的人更新文章时，社交网络使用事件驱动推送更新给用户<br>示例代码如下(来自于《精通python设计模式》)：<br>在输出中我们看到，添加额外的观察者，就会出现更多（相关的）输出；一个观察者被删除后，就再也不会被通知到。删除一个不存在的观察者或者两次添加相同的观察者。这都是通过Publisher类了来实行的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Publisher</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.observers = []<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span>(<span class="hljs-params">self, observer</span>):</span><br>        <span class="hljs-keyword">if</span> observer <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.observers:<br>            self.observers.append(observer)<br>        <span class="hljs-keyword">else</span>:<br>            print(<span class="hljs-string">&#x27;Failed to add: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(observer))<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remove</span>(<span class="hljs-params">self, observer</span>):</span><br>        <span class="hljs-keyword">try</span>:<br>            self.observers.remove(observer)<br>        <span class="hljs-keyword">except</span> ValueError:<br>            print(<span class="hljs-string">&#x27;Failed to remove: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(observer))<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">notify</span>(<span class="hljs-params">self</span>):</span><br>        [o.notify(self) <span class="hljs-keyword">for</span> o <span class="hljs-keyword">in</span> self.observers]<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DefaultFormatter</span>(<span class="hljs-params">Publisher</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span><br>        Publisher.__init__(self)<br>        self.name = name<br>        self._data = <span class="hljs-number">0</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&#123;&#125;: &#x27;&#123;&#125;&#x27; has data = &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(self).__name__, self.name, self._data)<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">data</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self._data<br><br><span class="hljs-meta">    @data.setter</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">data</span>(<span class="hljs-params">self, new_value</span>):</span><br>        <span class="hljs-keyword">try</span>:<br>            self._data = <span class="hljs-built_in">int</span>(new_value)<br>        <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:<br>            print(<span class="hljs-string">&#x27;Error: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(e))<br>        <span class="hljs-keyword">else</span>:<br>            self.notify()<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HexFormatter</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">notify</span>(<span class="hljs-params">self, publisher</span>):</span><br>        print(<span class="hljs-string">&quot;&#123;&#125;: &#x27;&#123;&#125;&#x27; has now hex data = &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(self).__name__,<br>                                                      publisher.name, <span class="hljs-built_in">hex</span>(publisher.data)))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BinaryFormatter</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">notify</span>(<span class="hljs-params">self, publisher</span>):</span><br>        print(<span class="hljs-string">&quot;&#123;&#125;: &#x27;&#123;&#125;&#x27; has now bin data = &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">type</span>(self).__name__,<br>                                                      publisher.name, <span class="hljs-built_in">bin</span>(publisher.data)))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    df = DefaultFormatter(<span class="hljs-string">&#x27;test1&#x27;</span>)<br>    print(df)<br><br>    print()<br>    hf = HexFormatter()<br>    df.add(hf)<br>    df.data = <span class="hljs-number">3</span><br>    print(df)<br><br>    print()<br>    bf = BinaryFormatter()<br>    df.add(bf)<br>    df.data = <span class="hljs-number">21</span><br>    print(df)<br><br>    print()<br>    df.remove(hf)<br>    df.data = <span class="hljs-number">40</span><br>    print(df)<br><br>    print()<br>    df.remove(hf)<br>    df.add(bf)<br>    df.data = <span class="hljs-string">&#x27;hello&#x27;</span><br>    print(df)<br><br>    print()<br>    df.data = <span class="hljs-number">15.8</span><br>    print(df)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<h3 id="状态模式（-）"><a href="#状态模式（-）" class="headerlink" title="状态模式（*）"></a>状态模式（*）</h3><blockquote>
<p>状态模式是一个或多个有限状态机（简称状态机）的实现，用于解决一个特定的软件工程问题。状态机是一个抽象机器，具有两个主要部分：状态和转换。状态是指一个系统的当前状况。一个状态机在任意时间点只会有一个激活状态。转换是指从当前状态到一个新状态的切换。在一个转换发生之前或之后通常会执行一个或多个动作。状态机可以使用状态图进行视觉上的展现。状态机用于解决许多计算机问题和非计算机问题，其中包括交通灯、停车计时器、硬件设计和编程语言解析等。我们也看到零食自动贩卖机是如何与状态机的工作方式相关联的。</p>
</blockquote>
<p>玩游戏时，我们可以经常看到状态模式，比如玩lol时，敌方有座防御塔，如果是你一个人走进去，你会被防御塔打，如果小兵先进去，你再进去时，防御塔会打小兵，如果敌方防御塔在范围内没监测到我方单位在里面，他就进入不攻击模式。<br>所以状态模式最重要的有两个点，一个是多个状态，第二是多个状态可以互相切换</p>
<p>示例代码如下(来自于《精通python设计模式》)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> state_machine <span class="hljs-keyword">import</span> State, Event, acts_as_state_machine, after, before, InvalidStateTransition<br><br><br><span class="hljs-meta">@acts_as_state_machine</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Process</span>:</span><br>    created = State(initial=<span class="hljs-literal">True</span>)<br>    waiting = State()<br>    running = State()<br>    terminated = State()<br>    blocked = State()<br>    swapped_out_waiting = State()<br>    swapped_out_blocked = State()<br><br>    wait = Event(from_states=(created, running, blocked,<br>                              swapped_out_waiting), to_state=waiting)<br>    run = Event(from_states=waiting, to_state=running)<br>    terminate = Event(from_states=running, to_state=terminated)<br>    block = Event(from_states=(running, swapped_out_blocked),<br>                  to_state=blocked)<br>    swap_wait = Event(from_states=waiting, to_state=swapped_out_waiting)<br>    swap_block = Event(from_states=blocked, to_state=swapped_out_blocked)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, name</span>):</span><br>        self.name = name<br><br><span class="hljs-meta">    @after(<span class="hljs-params"><span class="hljs-string">&#x27;wait&#x27;</span></span>)</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wait_info</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;&#123;&#125; entered waiting mode&#x27;</span>.<span class="hljs-built_in">format</span>(self.name))<br><br><span class="hljs-meta">    @after(<span class="hljs-params"><span class="hljs-string">&#x27;run&#x27;</span></span>)</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_info</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;&#123;&#125; is running&#x27;</span>.<span class="hljs-built_in">format</span>(self.name))<br><br><span class="hljs-meta">    @before(<span class="hljs-params"><span class="hljs-string">&#x27;terminate&#x27;</span></span>)</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">terminate_info</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;&#123;&#125; terminated&#x27;</span>.<span class="hljs-built_in">format</span>(self.name))<br><br><span class="hljs-meta">    @after(<span class="hljs-params"><span class="hljs-string">&#x27;block&#x27;</span></span>)</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">block_info</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;&#123;&#125; is blocked&#x27;</span>.<span class="hljs-built_in">format</span>(self.name))<br><br><span class="hljs-meta">    @after(<span class="hljs-params"><span class="hljs-string">&#x27;swap_wait&#x27;</span></span>)</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">swap_wait_info</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;&#123;&#125; is swapped out and waiting&#x27;</span>.<span class="hljs-built_in">format</span>(self.name))<br><br><span class="hljs-meta">    @after(<span class="hljs-params"><span class="hljs-string">&#x27;swap_block&#x27;</span></span>)</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">swap_block_info</span>(<span class="hljs-params">self</span>):</span><br>        print(<span class="hljs-string">&#x27;&#123;&#125; is swapped out and blocked&#x27;</span>.<span class="hljs-built_in">format</span>(self.name))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transition</span>(<span class="hljs-params">process, event, event_name</span>):</span><br>    <span class="hljs-keyword">try</span>:<br>        event()<br>    <span class="hljs-keyword">except</span> InvalidStateTransition <span class="hljs-keyword">as</span> err:<br>        print(<span class="hljs-string">&#x27;Error: transition of &#123;&#125; from &#123;&#125; to &#123;&#125; failed&#x27;</span>.<span class="hljs-built_in">format</span>(process.name,<br>                                                                    process.current_state, event_name))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">state_info</span>(<span class="hljs-params">process</span>):</span><br>    print(<span class="hljs-string">&#x27;state of &#123;&#125;: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(process.name, process.current_state))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    RUNNING = <span class="hljs-string">&#x27;running&#x27;</span><br>    WAITING = <span class="hljs-string">&#x27;waiting&#x27;</span><br>    BLOCKED = <span class="hljs-string">&#x27;blocked&#x27;</span><br>    TERMINATED = <span class="hljs-string">&#x27;terminated&#x27;</span><br><br>    p1, p2 = Process(<span class="hljs-string">&#x27;process1&#x27;</span>), Process(<span class="hljs-string">&#x27;process2&#x27;</span>)<br>    [state_info(p) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> (p1, p2)]<br><br>    print()<br>    transition(p1, p1.wait, WAITING)<br>    transition(p2, p2.terminate, TERMINATED)<br>    [state_info(p) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> (p1, p2)]<br><br>    print()<br>    transition(p1, p1.run, RUNNING)<br>    transition(p2, p2.wait, WAITING)<br>    [state_info(p) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> (p1, p2)]<br><br>    print()<br>    transition(p2, p2.run, RUNNING)<br>    [state_info(p) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> (p1, p2)]<br><br>    print()<br>    [transition(p, p.block, BLOCKED) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> (p1, p2)]<br>    [state_info(p) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> (p1, p2)]<br><br>    print()<br>    [transition(p, p.terminate, TERMINATED) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> (p1, p2)]<br>    [state_info(p) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> (p1, p2)]<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure>
<h3 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h3><p>策略模式，它最主要的特点是，可以把一系列（可互换的）算法封装起来，并根据用户需求来选择其中一种。例如python里面的sorted函数，根据key的不同，能按不同的方式排序。<br>我感觉是很多策略模式的集成于者？看后觉得是很多设计模式的都需要使用他，就像工厂模式里面，可以理解为根据用户选择不同的读取方式，把数据注入不同的工厂，再读取出来。（这里就不上代码了）</p>
<h3 id="模板模式-（-）"><a href="#模板模式-（-）" class="headerlink" title="模板模式 （*）"></a>模板模式 （*）</h3><p>这个模式在我写爬虫时就使用过了，但是我并不知道这叫模板模式。当时都思考了好久好久改了好多方案，包括用来效率比较差一点的if…elif…else的方法(这是由于其中一个网站的编码不一样导致我想用这种方法)。所以。。设计模式是之前的人归纳自己能提高自己写代码能力的方法，我们早点理解设计模式，就能少遇一些坑，也能更容易写出代码。</p>
<p>模板模式，就是几个函数的代码里面，只有小部分代码不同时。可以把这些函数的相同代码归为一个函数，根据不同的调用形成不同的原先的代码，旨在减少代码沉宇<br>以下代码来自于我的爬虫代码（修改于12月5日）：<br>其中url_parse就运用了模板模式通过传入的不同action之后就调用不同的数据清理函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> aiohttp<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pinpaigongyu_58city</span>(<span class="hljs-params">soup,city,page=<span class="hljs-number">1</span></span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    数据来自58品牌公寓</span><br><span class="hljs-string">    url由于是移动端提取的，所以拼接为电脑端（我网页只运行为电脑端）</span><br><span class="hljs-string">    address+info_title后期拼接后，高德能找到对应的位置，准确率提高</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    print(<span class="hljs-string">&#x27;开始爬取58同城&#x27;</span>+city+<span class="hljs-string">&#x27;的信息，第&#x27;</span>+<span class="hljs-built_in">str</span>(page)+<span class="hljs-string">&#x27;页&#x27;</span>)<br>    house_info_list = soup.find_all(<span class="hljs-string">&quot;li&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;item&quot;</span>&#125;)<br>    pattern_58city = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;%s(.+)&quot;</span> %city)<br>    <span class="hljs-keyword">for</span> house_info <span class="hljs-keyword">in</span> house_info_list:<br>        house_url = house_info.find(<span class="hljs-string">&quot;a&quot;</span>).get(<span class="hljs-string">&#x27;href&#x27;</span>)<br>        house_url = <span class="hljs-string">&#x27;http://&#x27;</span>+city+<span class="hljs-string">&#x27;.58.com&#x27;</span>+re.findall(pattern_58city, house_url)[<span class="hljs-number">0</span>]<br>        info_title = house_info.find(<span class="hljs-string">&quot;dt&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;info-title&quot;</span>&#125;).text.split(<span class="hljs-string">&quot;|&quot;</span>)[<span class="hljs-number">1</span>].split(<span class="hljs-string">&quot;-&quot;</span>)[<span class="hljs-number">0</span>].split(<span class="hljs-string">&quot;(&quot;</span>)[<span class="hljs-number">0</span>].strip()<br>        address = house_info.find(<span class="hljs-string">&quot;em&quot;</span>).text.strip()+info_title<br>        price = house_info.find(<span class="hljs-string">&quot;span&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;info-line2-price&quot;</span>&#125;).text.strip()<br>        price = re.findall(re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;\d+&#x27;</span>),price)[<span class="hljs-number">0</span>]<br>        room_info = house_info.find(<span class="hljs-string">&quot;dd&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;room_icon&quot;</span>&#125;).text.split(<span class="hljs-string">&quot;\n&quot;</span>)[<span class="hljs-number">1</span>:-<span class="hljs-number">2</span>]<br>        room_info = <span class="hljs-string">&quot;,&quot;</span>.join(room_info)<br>        sql_data(house_url,address,info_title,price,room_info)<br>    print(<span class="hljs-string">&#x27;爬取了58同城&#x27;</span>+city+<span class="hljs-string">&#x27;的信息，第&#x27;</span>+<span class="hljs-built_in">str</span>(page)+<span class="hljs-string">&#x27;页&#x27;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">anjuke</span>(<span class="hljs-params">soup,city,page=<span class="hljs-number">1</span></span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    数据来自安居客，速度比较慢</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    print(<span class="hljs-string">&#x27;开始爬取安居客&#x27;</span>+city+<span class="hljs-string">&#x27;的信息，第&#x27;</span>+<span class="hljs-built_in">str</span>(page)+<span class="hljs-string">&#x27;页&#x27;</span>)<br>    house_info_list = soup.find_all(<span class="hljs-string">&quot;div&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;zu-itemmod&quot;</span>&#125;)<br>    <span class="hljs-keyword">for</span> house_info <span class="hljs-keyword">in</span> house_info_list:<br>        house_url = house_info.get(<span class="hljs-string">&#x27;link&#x27;</span>)<br>        address_info_title = house_info.find(<span class="hljs-string">&quot;address&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;details-item&quot;</span>&#125;).text.split(<span class="hljs-string">&quot;［&quot;</span>)<br>        address = address_info_title[<span class="hljs-number">1</span>].strip().rstrip(<span class="hljs-string">&#x27;］&#x27;</span>)<br>        info_title = address_info_title[<span class="hljs-number">0</span>].strip()<br>        price = house_info.find(<span class="hljs-string">&quot;strong&quot;</span>).text<br>        room_info = house_info.find(<span class="hljs-string">&quot;p&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;details-item tag&quot;</span>&#125;).text.split(<span class="hljs-string">&quot;|&quot;</span>)<br>        room_info = <span class="hljs-string">&quot;,&quot;</span>.join(room_info)<br>        print(house_url,address,info_title,price,room_info)<br>        sql_data(house_url,address,info_title,price,room_info)<br>    print(<span class="hljs-string">&#x27;爬取了安居客&#x27;</span>+city+<span class="hljs-string">&#x27;的信息，第&#x27;</span>+<span class="hljs-built_in">str</span>(page)+<span class="hljs-string">&#x27;页&#x27;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fang</span>(<span class="hljs-params">soup,city,page=<span class="hljs-number">1</span></span>):</span><br>    print(<span class="hljs-string">&#x27;开始爬取房天下&#x27;</span>+city+<span class="hljs-string">&#x27;的信息，第&#x27;</span>+<span class="hljs-built_in">str</span>(page)+<span class="hljs-string">&#x27;页&#x27;</span>)<br>    house_info_list = soup.find_all(<span class="hljs-string">&quot;dl&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;list hiddenMap rel&quot;</span>&#125;)<br>    <span class="hljs-keyword">for</span> house_info <span class="hljs-keyword">in</span> house_info_list:<br>        house_url = <span class="hljs-string">&#x27;http://zu.&#x27;</span>+city+<span class="hljs-string">&#x27;.fang.com&#x27;</span>+house_info.find(<span class="hljs-string">&quot;a&quot;</span>,&#123;<span class="hljs-string">&quot;target&quot;</span>:<span class="hljs-string">&quot;_blank&quot;</span>&#125;).get(<span class="hljs-string">&#x27;href&#x27;</span>)<br>        address = house_info.find(<span class="hljs-string">&quot;p&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;gray6 mt20&quot;</span>&#125;).text<br>        info_title = address.split(<span class="hljs-string">&quot;-&quot;</span>)[-<span class="hljs-number">1</span>].strip()<br>        price = house_info.find(<span class="hljs-string">&quot;span&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;price&quot;</span>&#125;).text<br>        <span class="hljs-keyword">try</span>:<br>            room_info = (house_info.find(<span class="hljs-string">&quot;span&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;note colorGreen&quot;</span>&#125;).text<br>                        +<span class="hljs-string">&#x27;-&#x27;</span>+house_info.find(<span class="hljs-string">&quot;span&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;note colorBlue&quot;</span>&#125;).text<br>                        +<span class="hljs-string">&#x27;-&#x27;</span>+house_info.find(<span class="hljs-string">&quot;span&quot;</span>,&#123;<span class="hljs-string">&quot;class&quot;</span>:<span class="hljs-string">&quot;note colorRed&quot;</span>&#125;).text).strip()<br>        <span class="hljs-keyword">except</span>:<br>            room_info = <span class="hljs-string">&#x27;没有房间具体信息&#x27;</span><br>        sql_data(house_url,address,info_title,price,room_info)<br>    print(<span class="hljs-string">&#x27;爬取了房天下&#x27;</span>+city+<span class="hljs-string">&#x27;的信息，第&#x27;</span>+<span class="hljs-built_in">str</span>(page)+<span class="hljs-string">&#x27;页&#x27;</span>)<br><br><br><br><br><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sql_data</span>(<span class="hljs-params">house_url,address,info_title,price,room_info</span>):</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    写入数据</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    print(house_url+<span class="hljs-string">&#x27;|&#x27;</span>+address+<span class="hljs-string">&#x27;|&#x27;</span>+info_title+<span class="hljs-string">&#x27;|&#x27;</span>+price+<span class="hljs-string">&#x27;|&#x27;</span>+room_info)<br>    print(<span class="hljs-string">&#x27;--------&#x27;</span>)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">url_parse</span>(<span class="hljs-params">url,city,page,action</span>):</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    解析网页，之后转入对应的函数进行数据清理</span><br><span class="hljs-string">    使用协程启动，对这两个库还没那么了解，之后再改动得好点</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    headers=&#123;<span class="hljs-string">&#x27;User-Agent&#x27;</span>:<span class="hljs-string">&#x27;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36&#x27;</span>&#125;<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:<br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(url,headers=headers) <span class="hljs-keyword">as</span> resp:<br>            print(url, resp.status)<br>            <span class="hljs-keyword">if</span> resp.status == <span class="hljs-number">200</span>:<br>                <span class="hljs-keyword">try</span>:<br>                    soup = BeautifulSoup(<span class="hljs-keyword">await</span> resp.text(),<span class="hljs-string">&quot;html.parser&quot;</span>)<br>                <span class="hljs-keyword">except</span>:<br>                    soup = BeautifulSoup(<span class="hljs-keyword">await</span> resp.text(encoding=<span class="hljs-string">&#x27;gbk&#x27;</span>),<span class="hljs-string">&quot;html.parser&quot;</span>)<span class="hljs-comment">#网站差评，写了gb2312里面却有不是gb2312的符号</span><br>                action(soup,city,page)<br>            <span class="hljs-keyword">elif</span> url <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> url_temp_list:<br>                url_temp_list.append(url)<br>                url_parse(url,city,page) <span class="hljs-comment">#重新爬取一次</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;该url无法爬取:%s&quot;</span> % url)<br><br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    tasks = []                  <span class="hljs-comment">#协程启动的list</span><br>    url_temp_list = []          <span class="hljs-comment">#爬去失败暂存的url</span><br>    page_all = <span class="hljs-number">2</span>                <span class="hljs-comment">#爬取页数</span><br>    city_list = [<span class="hljs-string">&#x27;sz&#x27;</span>,<span class="hljs-string">&#x27;gz&#x27;</span>]     <span class="hljs-comment">#爬取的城市</span><br><br>    <span class="hljs-comment">#url列表，把url的城市换为city，页码换为page</span><br>    url_list = [<br>               [<span class="hljs-string">&#x27;http://m.58.com/city/pinpaigongyu/pnpage/?segment=true&#x27;</span>,pinpaigongyu_58city],<br>               [<span class="hljs-string">&#x27;https://city.zu.anjuke.com/fangyuan/ppage&#x27;</span>,anjuke],<br>               [<span class="hljs-string">&#x27;http://zu.city.fang.com/house/i3page&#x27;</span>,fang]<br>               ]<br><br>    <span class="hljs-comment">#生成tasks</span><br>    <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(page_all):<br>        page = page+<span class="hljs-number">1</span><br>        <span class="hljs-keyword">for</span> city <span class="hljs-keyword">in</span> city_list:<br>            <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> url_list:<br>                url_temp = url[<span class="hljs-number">0</span>].replace(<span class="hljs-string">&#x27;city&#x27;</span>,city)<br>                url_temp = url_temp.replace(<span class="hljs-string">&#x27;page&#x27;</span>,<span class="hljs-built_in">str</span>(page))<br>                tasks.append(url_parse(url_temp,city,page,url[<span class="hljs-number">1</span>]))<br><br>    start_time = time.time()<br>    loop = asyncio.get_event_loop()                 <span class="hljs-comment"># 得到一个事件循环模型</span><br>    loop.run_until_complete(asyncio.wait(tasks))    <span class="hljs-comment"># 执行任务</span><br>    loop.close()   <br><br>    end_time = time.time()<br>    print(end_time-start_time)<br></code></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>设计模式，是对编程的一个规范，各个设计模式之间会有许多相连，或者有很多共同的地方。就像我们在写代码时，可能一个代码就运用了很多设计模式，有时觉得能不能分清他们并不是最重要的，最重要的是如何使用他们，理解好他们，来提高我们的生产力。</p>
      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>So1n</li>
    <li><strong>本文链接：</strong><a href="http://so1n.me/2017/11/10/18_python_design_patterns/index.html" title="http:&#x2F;&#x2F;so1n.me&#x2F;2017&#x2F;11&#x2F;10&#x2F;18_python_design_patterns&#x2F;index.html">http:&#x2F;&#x2F;so1n.me&#x2F;2017&#x2F;11&#x2F;10&#x2F;18_python_design_patterns&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img src="https://github.com/so1n/so1n_blog_photo/blob/master/blog_photo/4d2ebf32586d8799ee2e75333d6f5d2.jpg?raw=true">
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul> 

        
  <nav class="nav">
    <a href="/2017/12/13/24_high%20_performance_mySQL_3rd_notes/"><i class="iconfont iconleft"></i>Mysql笔记(-第五章)</a>
    <a href="/2017/11/07/17_python_notes/">python记录<i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
        <section class="comments">
  
    <div class="btn" id="comments-btn">查看评论</div>
  
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<div id="gitalk" class="gitalk"></div>
<script defer src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
  window.onload = function () {
    var gitalk = new Gitalk({
      clientID: '59f804e526b05c378470',
      clientSecret: '36679ff697cec424936a0f7c4bcd6d2988dac28e',
      id: window.location.pathname,
      repo: 'so1n.github.io',
      owner: 'so1n',
      admin: 'so1n'
    });
    if ( true ) {
      $("#comments-btn").on("click", function () {
        $(this).hide();
        gitalk.render('gitalk');
      });
    } else {
      gitalk.render('gitalk');
    }
  }
</script>

</section>
      
    </section>
  </div>
</article>
</div>
      <div class="col-xl-3">
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%AE%B0"><span class="toc-text">前记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8"><span class="toc-text">备注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">创建型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-%EF%BC%88-%EF%BC%89"><span class="toc-text">工厂模式 （*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">建造者模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">抽象工厂模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">单例模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">原型模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">结构型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">适配器模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">修饰器模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">外观模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">享元模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B-%E8%A7%86%E5%9B%BE-%E6%8E%A7%E5%88%B6%E5%99%A8%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">模型-视图-控制器模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">代理模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-text">命令模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">解释器模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">观察者模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">状态模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text">策略模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F-%EF%BC%88-%EF%BC%89"><span class="toc-text">模板模式 （*）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol>
  </aside>

        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%AE%B0"><span class="toc-text">前记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E6%B3%A8"><span class="toc-text">备注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">创建型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F-%EF%BC%88-%EF%BC%89"><span class="toc-text">工厂模式 （*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">建造者模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">抽象工厂模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">单例模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">原型模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">结构型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">适配器模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">修饰器模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">外观模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">享元模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B-%E8%A7%86%E5%9B%BE-%E6%8E%A7%E5%88%B6%E5%99%A8%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">模型-视图-控制器模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">代理模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-text">命令模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">解释器模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">观察者模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%EF%BC%88-%EF%BC%89"><span class="toc-text">状态模式（*）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text">策略模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F-%EF%BC%88-%EF%BC%89"><span class="toc-text">模板模式 （*）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>


<footer class="footer">
  <div class="footer-social"><a 
        href="https://github.com/so1n "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
  
  <div class="footer-copyright">
    总访问量<span id="busuanzi_value_site_pv"></span>次
    访客数<span id="busuanzi_value_site_uv"></span>人次
  </div>

</footer>

  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
  
    <div class="scrollbar j-scrollbar">
  <div class="scrollbar-current j-scrollbar-current"></div>
</div>
  
  
    
<script src="/js/color-mode.js"></script>

  
  
    <div class="search">
  <div class="search-container">
    <div class="search-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <div class="search-input-wrapper">
      <i class="search-input-icon iconfont iconsearch"></i>
      <input class="search-input" type="search" id="search-input" placeholder="Search..." autofocus autocomplete="off"
        autocorrect="off" autocapitalize="off">
    </div>
    <div class="search-output" id="search-output"></div>
  </div>
</div>
  
</body>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>



  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>






  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>




<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>







  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>













</html>